import{n as e,o as s,p as l}from"./index-D64fSWen.js";import{M as a}from"./index-yWgYGWn4.js";import{A as i}from"./index-DFMXDXNR.js";import{I as t,C as r,T as n}from"./AntdIcon-BrIVTVC9.js";import{D as c}from"./index-DQw-pPfg.js";import{R as o}from"./CloseOutlined-B--xzqQ7.js";import{r as d}from"./react-vendor-B_j1QKL9.js";import{F as j}from"./index-D88ViWFg.js";import{R as m,C as h}from"./row-KUrmra0O.js";import{I as x}from"./index-Ba3ggKkW.js";import{T as u}from"./index-DpPhw_8z.js";import{B as p}from"./EllipsisOutlined-B7G7Lika.js";import{R as g}from"./PlusOutlined-BzVVLDjU.js";import{R as v}from"./SaveOutlined-BoOqeck_.js";import{s as f}from"./index-CNd4JuwY.js";import{R as y}from"./DeleteOutlined-BGdJH0Vj.js";import{p as b}from"./config-C-P0NNBq.js";import{T as I}from"./index-OFQobG-o.js";import{S}from"./index-BVzpzorU.js";import{F as N}from"./Table-CcmlabOw.js";import{T as k}from"./index-ChgZ5ieq.js";import{R as w}from"./EyeOutlined-DyWz_EC7.js";import{R as C}from"./EditOutlined-BSaIuPsK.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./InfoCircleFilled-CZmHaujc.js";import"./context-C6B8do_o.js";import"./DownOutlined-CLoAI_il.js";import"./TextArea-RvXwFgUf.js";import"./EditOutlined-jOoJX1ad.js";import"./CheckOutlined-BLh5wKOq.js";import"./index-GvAVA_fY.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},z.apply(this,arguments)}const D=(e,s)=>d.createElement(t,z({},e,{ref:s,icon:T})),E=d.forwardRef(D),V=({najieDetailVisible:e,setNajieDetailVisible:l,selectedNajie:t,getTotalItems:n})=>{var d,j,m,h,x,u,p,g,v;return s.jsx(a,{title:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{children:"corrupted"===(null==t?void 0:t.数据状态)?"损坏数据详情":"背包详情"})}),open:e,onCancel:()=>l(!1),footer:null,closeIcon:s.jsx(o,{className:""}),className:"",width:"corrupted"===(null==t?void 0:t.数据状态)?1200:800,children:t&&s.jsx("div",{className:"space-y-6",children:"corrupted"===t.数据状态?s.jsx("div",{children:s.jsx(i,{message:"损坏数据 - 原始JSON内容",description:s.jsxs("div",{children:[s.jsxs("p",{className:"mb-2",children:["错误信息: ",t.错误信息]}),s.jsx("pre",{className:"text-xs overflow-auto",style:{maxHeight:400},children:t.原始数据})]}),type:"error",showIcon:!0})}):s.jsxs(s.Fragment,{children:[s.jsx(r,{title:"基础信息",size:"small",children:s.jsxs(c,{column:2,size:"small",children:[s.jsx(c.Item,{label:"用户ID",children:t.userId}),s.jsx(c.Item,{label:"背包等级",children:t.等级??1}),s.jsx(c.Item,{label:"总物品数",children:n(t)}),s.jsx(c.Item,{label:"当前灵石",children:(null==(d=t.灵石)?void 0:d.toLocaleString())??0})]})}),s.jsx(r,{title:"物品统计",size:"small",children:s.jsxs(c,{column:4,size:"small",children:[s.jsx(c.Item,{label:"装备",children:(null==(j=t.装备)?void 0:j.length)??0}),s.jsx(c.Item,{label:"丹药",children:(null==(m=t.丹药)?void 0:m.length)??0}),s.jsx(c.Item,{label:"道具",children:(null==(h=t.道具)?void 0:h.length)??0}),s.jsx(c.Item,{label:"功法",children:(null==(x=t.功法)?void 0:x.length)??0})]})}),s.jsx(r,{title:"其他物品",size:"small",children:s.jsxs(c,{column:4,size:"small",children:[s.jsx(c.Item,{label:"草药",children:(null==(u=t.草药)?void 0:u.length)??0}),s.jsx(c.Item,{label:"材料",children:(null==(p=t.材料)?void 0:p.length)??0}),s.jsx(c.Item,{label:"仙宠",children:(null==(g=t.仙宠)?void 0:g.length)??0}),s.jsx(c.Item,{label:"灵石上限",children:(null==(v=t.灵石上限)?void 0:v.toLocaleString())??0})]})})]})})})},O=[{key:"装备",label:"装备"},{key:"丹药",label:"丹药"},{key:"道具",label:"道具"},{key:"功法",label:"功法"},{key:"草药",label:"草药"},{key:"材料",label:"材料"},{key:"仙宠",label:"仙宠"},{key:"仙宠口粮",label:"仙宠口粮"}];function A({visible:e,onCancel:l,onSave:i,najie:t,loading:c=!1}){const[o]=j.useForm(),[b,I]=d.useState(null),[S,N]=d.useState("");d.useEffect(()=>{e&&t&&(I({...t}),o.setFieldsValue({userId:t.userId,"灵石":t.灵石,"灵石上限":t.灵石上限,"等级":t.等级}))},[e,t,o]);const k=(e,s,l,a)=>{if(!b)return;const i=(b[e]||[]).map((e,i)=>i===s?{...e,[l]:a}:e);I({...b,[e]:i})},w=(e,l,a)=>s.jsx(r,{className:"mb-3",size:"small",children:s.jsxs(m,{gutter:[8,8],children:[s.jsx(h,{span:8,children:s.jsx(x,{placeholder:"物品名称",value:e.name,onChange:e=>k(l,a,"name",e.target.value)})}),s.jsx(h,{span:4,children:s.jsx(x,{placeholder:"品质",value:e.grade,onChange:e=>k(l,a,"grade",e.target.value)})}),s.jsx(h,{span:3,children:s.jsx(u,{placeholder:"品级",value:e.pinji,onChange:e=>k(l,a,"pinji",e),className:"w-full",min:1})}),s.jsx(h,{span:3,children:s.jsx(u,{placeholder:"数量",value:e.数量,onChange:e=>k(l,a,"数量",e),className:"w-full",min:1})}),s.jsx(h,{span:3,children:s.jsx(u,{placeholder:"攻击",value:e.atk,onChange:e=>k(l,a,"atk",e),className:"w-full"})}),s.jsx(h,{span:3,children:s.jsx(p,{type:"text",danger:!0,icon:s.jsx(y,{}),onClick:()=>((e,s)=>{if(!b)return;const l=(b[e]||[]).filter((e,l)=>l!==s);I({...b,[e]:l})})(l,a)})})]})},a);return s.jsx(a,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:"编辑背包"}),s.jsxs("span",{children:["用户ID: ",null==t?void 0:t.userId]})]}),open:e,onCancel:l,width:1200,footer:[s.jsx(p,{onClick:l,children:"取消"},"cancel"),s.jsx(p,{type:"primary",icon:s.jsx(v,{}),onClick:()=>{(async()=>{try{const e=await o.validateFields();if(b){const s={...b,userId:e.userId,"灵石":e.灵石,"灵石上限":e.灵石上限,"等级":e.等级};i(s)}}catch(e){}})()},loading:c,children:"保存"},"save")],className:"",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(r,{children:s.jsx(j,{form:o,layout:"vertical",children:s.jsxs(m,{gutter:16,children:[s.jsx(h,{span:8,children:s.jsx(j.Item,{label:"用户ID",name:"userId",rules:[{required:!0,message:"请输入用户ID"}],children:s.jsx(x,{})})}),s.jsx(h,{span:8,children:s.jsx(j.Item,{label:"灵石",name:"灵石",rules:[{required:!0,message:"请输入灵石数量"}],children:s.jsx(u,{className:"w-full",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))??""})})}),s.jsx(h,{span:8,children:s.jsx(j.Item,{label:"灵石上限",name:"灵石上限",children:s.jsx(u,{className:"w-full",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))??""})})})]})})}),s.jsx(n,{type:"card",tabBarGutter:8,items:O.map(e=>{var l;return{key:e.key,label:s.jsxs("span",{children:[e.label," (",Array.isArray(null==b?void 0:b[e.key])?(null==(l=null==b?void 0:b[e.key])?void 0:l.length)??0:0,")"]}),children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("span",{className:"font-medium",children:e.label}),s.jsxs("div",{className:"flex gap-6",children:[s.jsx(x,{value:S,onChange:e=>N(e.target.value),style:{maxWidth:160}}),s.jsx(p,{type:"primary",icon:s.jsx(g,{}),onClick:()=>(e=>{if(!S)return;if(!b)return;if(b[e].some(e=>e.name===S))return void f.error("已存在该物品");const s={name:S,grade:"",pinji:1,"数量":1};I({...b,[e]:[...b[e]||[],s]})})(e.key),children:"添加物品"})]})]}),s.jsx("div",{className:"space-y-2",children:((null==b?void 0:b[e.key])??[]).map((s,l)=>w(s,e.key,l))}),(()=>{const s=null==b?void 0:b[e.key];return!s||!Array.isArray(s)||0===s.length})()&&s.jsxs("div",{className:"text-center py-8",children:["暂无",e.label,"，点击上方按钮添加"]})]})}})})]})})}const F=()=>{const{user:s}=l(),[a,i]=d.useState([]),[t,r]=d.useState(!1),[n,c]=d.useState(""),[o,j]=d.useState(null),[m,h]=d.useState(!1),[x,u]=d.useState(!1),[p,g]=d.useState(!1),[v,y]=d.useState({current:1,pageSize:b,total:0,totalPages:0}),I=async(l=1,a=b)=>{if(s){r(!0);try{if(!localStorage.getItem("token"))return void f.error("未找到登录令牌");const s=await(async(s={})=>{try{const l=await e({url:"/najie",method:"GET",params:s});return 200===l.code?{success:!0,data:l.data}:{success:!1,message:l.message}}catch(l){return{success:!1,message:"网络错误"}}})({page:l,pageSize:a,search:n});s.success&&s.data?(i(s.data.list),y(s.data.pagination)):f.error(s.message??"获取背包数据失败")}catch(t){f.error("获取背包数据失败")}finally{r(!1)}}};d.useEffect(()=>{I(1,b)},[s]);return{najieList:a,loading:t,searchText:n,selectedNajie:o,najieDetailVisible:m,najieEditVisible:x,editLoading:p,pagination:v,fetchNajie:I,handleSearchAndFilter:()=>{I(1,v.pageSize)},handleTableChange:(e,s)=>{I(e,s)},handleEditNajie:e=>{j(e),u(!0)},handleSaveNajie:async s=>{g(!0);try{if(!localStorage.getItem("token"))return void f.error("未找到登录令牌");const l=await(async s=>{try{const l=await e({url:"/najie",method:"PUT",data:s});return 200===l.code?{success:!0,message:l.message||"纳戒信息更新成功"}:{success:!1,message:l.message||"纳戒信息更新失败"}}catch(l){return{success:!1,message:"更新纳戒信息失败"}}})(s);l.success?(f.success("背包更新成功"),u(!1),await I(v.current,v.pageSize)):f.error(l.message??"背包更新失败")}catch(l){f.error("背包更新失败")}finally{g(!1)}},getTotalItems:e=>["装备","丹药","道具","功法","草药","材料","仙宠","仙宠口粮"].reduce((s,l)=>s+(Array.isArray(e[l])?e[l].length:0),0),setSearchText:c,setSelectedNajie:j,setNajieDetailVisible:h,setNajieEditVisible:u}};function R(){const{najieList:e,loading:l,searchText:a,selectedNajie:i,najieDetailVisible:t,najieEditVisible:n,editLoading:c,pagination:o,fetchNajie:d,handleSearchAndFilter:j,handleTableChange:m,handleEditNajie:h,handleSaveNajie:u,getTotalItems:g,setSearchText:v,setSelectedNajie:f,setNajieDetailVisible:y,setNajieEditVisible:b}=F(),T=[{title:"用户信息",key:"userInfo",width:150,render:(e,l)=>s.jsxs(S,{direction:"vertical",size:0,children:[s.jsxs(I.Text,{strong:!0,children:["用户ID: ",l.userId]}),s.jsxs(I.Text,{type:"secondary",children:["背包等级: ",l.等级??1]})]})},{title:"灵石信息",key:"lingshi",width:120,render:(e,l)=>s.jsxs(S,{direction:"vertical",size:0,children:[s.jsxs(I.Text,{children:["当前: ",(l.灵石??0).toLocaleString()]}),s.jsxs(I.Text,{children:["上限: ",(l.灵石上限??0).toLocaleString()]})]})},{title:"物品统计",key:"items",width:200,render:(e,l)=>{var a,i,t;return s.jsxs(S,{direction:"vertical",size:0,children:[s.jsxs(I.Text,{children:["总物品: ",g(l)]}),s.jsxs(I.Text,{children:["装备: ",(null==(a=l.装备)?void 0:a.length)??0]}),s.jsxs(I.Text,{children:["丹药: ",(null==(i=l.丹药)?void 0:i.length)??0]}),s.jsxs(I.Text,{children:["道具: ",(null==(t=l.道具)?void 0:t.length)??0]})]})}},{title:"操作",key:"actions",width:120,render:(e,l)=>s.jsxs(S,{children:[s.jsx(k,{title:"查看详情",children:s.jsx(p,{type:"primary",icon:s.jsx(w,{}),onClick:()=>{f(l),y(!0)}})}),s.jsx(k,{title:"编辑背包",children:s.jsx(p,{icon:s.jsx(C,{}),onClick:()=>h(l)})})]})}];return s.jsxs("div",{className:"space-y-6 bg-slate-200 p-4",children:[s.jsx(r,{title:s.jsxs(S,{align:"center",children:[s.jsx(E,{}),s.jsx(I.Text,{strong:!0,children:"背包管理"})]}),extra:s.jsx(p,{type:"primary",loading:l,onClick:()=>{d(1,o.pageSize)},children:"刷新"}),children:s.jsx(I.Text,{type:"secondary",children:"管理修仙界道友的背包物品"})}),s.jsx(x.Search,{placeholder:"搜索用户ID",value:a,onChange:e=>v(e.target.value),onSearch:()=>{j()},onPressEnter:()=>{j()},allowClear:!0}),s.jsx(r,{title:"背包列表",children:s.jsx(N,{columns:T,dataSource:e,rowKey:"userId",loading:l,pagination:{current:o.current,pageSize:o.pageSize,total:o.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onChange:e=>{m(e.current,e.pageSize)},scroll:{x:1e3}})}),s.jsx(V,{najieDetailVisible:t,setNajieDetailVisible:y,selectedNajie:i,getTotalItems:g}),s.jsx(A,{visible:n,onCancel:()=>b(!1),onSave:e=>{u(e)},najie:i,loading:c})]})}export{R as default};
