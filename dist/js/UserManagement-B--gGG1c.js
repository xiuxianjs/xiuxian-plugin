import{d as e,G as s,j as a,P as t,R as r}from"./index-B2-_ZLms.js";import{r as n}from"./react-vendor-BNT5GVrG.js";import{B as i,S as l,I as c}from"./XiuxianUserSelector-V8nxbYv3.js";import{X as o}from"./XiuxianPageWrapper-Zl8u_bfP.js";import{X as d}from"./XiuxianPageTitle-B5ecsZ4O.js";import{X as m}from"./XiuxianSearchBar-Cu1yzUSy.js";import{X as u}from"./XiuxianTableContainer-B8xoFjcM.js";import{X as x}from"./XiuxianRefreshButton-CzB3HRh7.js";import{X as h}from"./XiuxianTableWithPagination-DApRXYI2.js";import{F as p}from"./index-DD6F8Z9c.js";import{R as j}from"./PlusOutlined-CD-RqJCY.js";import{R as g}from"./CheckCircleOutlined-DEuy05Ii.js";import{R as f,P as v}from"./StopOutlined-XJcj9G5N.js";import{R as y}from"./UserOutlined-Cupqygyo.js";import{M as w}from"./index-BzulwkGu.js";import{R as S,C as N}from"./row-Cv38SxUN.js";import{s as b}from"./index-Owlwo0eD.js";import{T as C}from"./index-BDKxg7_F.js";import{I as E,S as k}from"./AntdIcon-KqtHakU8.js";import{R as z}from"./EditOutlined-DFgGIxaV.js";import{R as P}from"./DeleteOutlined-Zy2bq4gi.js";import"./SearchOutlined-D0yxu0_S.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-DsR3YBEN.js";import"./context-BiMxOUho.js";import"./index-CVjKQClW.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};function O(){return O=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},O.apply(this,arguments)}const I=(e,s)=>n.createElement(E,O({},e,{ref:s,icon:T})),R=n.forwardRef(I);function U({permission:e,fallback:t=null,children:r}){let n=e=>!1;try{n=s().hasPermission}catch(i){}return n(e)?a.jsx(a.Fragment,{children:r}):a.jsx(a.Fragment,{children:t})}const{Option:A}=l;function X(){const[s,E]=n.useState([]),[T,O]=n.useState(!1),[I,X]=n.useState(""),[D,$]=n.useState(""),[F,_]=n.useState(""),[L,B]=n.useState([]),[q,K]=n.useState(!1),[G,M]=n.useState(null),[Q]=p.useForm(),[W,H]=n.useState({current:1,pageSize:10,total:0}),J=async(s=1,a=10)=>{O(!0);try{const t=await(async(s={})=>{try{const a=await e({url:"/admin/users",method:"GET",params:s});return 200===a.code?{success:!0,message:a.message,data:a.data}:{success:!1,message:a.message||"获取用户列表失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})({page:s,pageSize:a,search:I,role:D||void 0,status:F||void 0});t.success&&t.data?(E(t.data.users),H({current:t.data.page,pageSize:t.data.pageSize,total:t.data.total})):b.error(t.message||"获取用户列表失败")}catch(t){b.error("获取用户列表失败")}finally{O(!1)}},V=async s=>{try{const a=await(async s=>{try{const a=await e({url:`/admin/users/${s}`,method:"DELETE"});return 200===a.code?{success:!0,message:a.message||"用户删除成功"}:{success:!1,message:a.message||"用户删除失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s);a.success?(b.success("用户删除成功"),J(W.current,W.pageSize)):b.error(a.message||"删除失败")}catch(a){b.error("删除用户失败")}},Z=async s=>{try{const a=await(async s=>{try{const a=await e({url:`/admin/users/${s}/reset-password`,method:"POST"});return 200===a.code?{success:!0,message:a.message||"密码重置成功",data:a.data}:{success:!1,message:a.message||"密码重置失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s);a.success&&a.data?b.success(`密码重置成功，新密码：${a.data.newPassword}`):b.error(a.message||"密码重置失败")}catch(a){b.error("重置密码失败")}},Y=async(s,a)=>{try{const t=await(async(s,a)=>{try{const t=await e({url:`/admin/users/${s}/status`,method:"PATCH",data:{status:a}});return 200===t.code?{success:!0,message:t.message||"状态更新成功",data:t.data}:{success:!1,message:t.message||"状态更新失败"}}catch(t){return{success:!1,message:"错误，请重试"}}})(s,a);t.success?(b.success("状态更新成功"),J(W.current,W.pageSize)):b.error(t.message||"状态更新失败")}catch(t){b.error("更新状态失败")}},ee=async s=>{if(0!==L.length)try{const a=await(async s=>{try{const a=await e({url:"/admin/users/batch",method:"POST",data:s});return 200===a.code?{success:!0,message:a.message||"批量操作完成",data:a.data}:{success:!1,message:a.message||"批量操作失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})({userIds:L,operation:s});a.success&&a.data?(b.success(`批量操作完成，成功 ${a.data.successCount} 个，失败 ${a.data.failedCount} 个`),B([]),J(W.current,W.pageSize)):b.error(a.message||"批量操作失败")}catch(a){b.error("批量操作失败")}else b.warning("请选择要操作的用户")},se=[{title:"用户信息",key:"userInfo",width:200,render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold",children:s.username.charAt(0).toUpperCase()}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-white",children:s.username}),a.jsx("div",{className:"text-sm text-slate-400",children:s.realName||"未设置"})]})]})},{title:"角色",dataIndex:"role",key:"role",width:120,render:e=>{const s=r[e];return a.jsx(C,{color:s.color,icon:a.jsx("span",{children:s.icon}),children:s.name})}},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>(e=>{const s={active:{color:"green",text:"正常"},inactive:{color:"orange",text:"未激活"},suspended:{color:"red",text:"已暂停"}}[e]||{color:"default",text:e};return a.jsx(C,{color:s.color,children:s.text})})(e)},{title:"部门",dataIndex:"department",key:"department",width:120,render:e=>e||"未设置"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleString("zh-CN")},{title:"最后登录",dataIndex:"lastLoginAt",key:"lastLoginAt",width:150,render:e=>e?new Date(e).toLocaleString("zh-CN"):"从未登录"},{title:"操作",key:"actions",width:200,render:(e,s)=>a.jsxs(k,{children:[a.jsx(U,{permission:t.USER_UPDATE,children:a.jsx(i,{type:"text",size:"small",icon:a.jsx(z,{}),onClick:()=>{return M(e=s),Q.setFieldsValue({username:e.username,email:e.email,role:e.role,status:e.status,realName:e.realName,department:e.department,phone:e.phone}),void K(!0);var e},className:"text-blue-400 hover:text-blue-300",children:"编辑"})}),a.jsx(U,{permission:t.USER_UPDATE,children:a.jsx(i,{type:"text",size:"small",icon:a.jsx(R,{}),onClick:()=>Z(s.id),className:"text-orange-400 hover:text-orange-300",children:"重置密码"})}),a.jsx(U,{permission:t.USER_UPDATE,children:a.jsx(i,{type:"text",size:"small",icon:"active"===s.status?a.jsx(f,{}):a.jsx(g,{}),onClick:()=>Y(s.id,"active"===s.status?"suspended":"active"),className:"active"===s.status?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:"active"===s.status?"暂停":"激活"})}),a.jsx(U,{permission:t.USER_DELETE,children:a.jsx(v,{title:"确定要删除这个用户吗？",onConfirm:()=>V(s.id),okText:"确定",cancelText:"取消",children:a.jsx(i,{type:"text",size:"small",icon:a.jsx(P,{}),className:"text-red-400 hover:text-red-300",children:"删除"})})})]})}],ae={selectedRowKeys:L,onChange:e=>{B(e)}},te=()=>{H(e=>({...e,current:1})),J(1,W.pageSize)};return n.useEffect(()=>{J()},[]),s.length,s.filter(e=>"active"===e.status).length,s.filter(e=>"inactive"===e.status).length,s.filter(e=>"suspended"===e.status).length,a.jsxs(o,{children:[a.jsx(d,{icon:a.jsx(y,{}),title:"账户管理",subtitle:"管理系统用户账户和权限",actions:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(U,{permission:t.USER_CREATE,children:a.jsx(i,{type:"primary",icon:a.jsx(j,{}),onClick:()=>{M(null),Q.resetFields(),K(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 border-0 hover:from-green-600 hover:to-emerald-600",children:"创建用户"})}),a.jsx(U,{permission:t.USER_UPDATE,children:a.jsxs(i,{danger:!0,icon:a.jsx(g,{}),disabled:0===L.length,onClick:()=>ee("activate"),children:["批量激活 (",L.length,")"]})}),a.jsx(U,{permission:t.USER_UPDATE,children:a.jsxs(i,{danger:!0,icon:a.jsx(f,{}),disabled:0===L.length,onClick:()=>ee("suspend"),children:["批量暂停 (",L.length,")"]})}),a.jsx(x,{loading:T,onClick:()=>J(W.current,W.pageSize)})]})}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(m,{placeholder:"搜索用户名或真实姓名...",value:I,onChange:X,onSearch:te,className:"mb-0"}),a.jsx("div",{className:"flex flex-col gap-2 bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-lg mb-6",children:a.jsxs("div",{className:"flex gap-4 justify-end",children:[a.jsx(l,{placeholder:"选择角色",value:D,onChange:$,className:"w-40",allowClear:!0,children:Object.values(r).map(e=>a.jsxs(A,{value:e.role,children:[e.icon," ",e.name]},e.role))}),a.jsxs(l,{placeholder:"选择状态",value:F,onChange:_,className:"w-32",allowClear:!0,children:[a.jsx(A,{value:"active",children:"正常"}),a.jsx(A,{value:"inactive",children:"未激活"}),a.jsx(A,{value:"suspended",children:"已暂停"})]}),a.jsx(i,{type:"primary",onClick:te,children:"搜索"})]})})]}),a.jsx(u,{title:"用户列表",icon:a.jsx(y,{}),children:a.jsx(h,{columns:se,dataSource:s,rowKey:"id",loading:T,rowSelection:ae,pagination:{current:W.current,pageSize:W.pageSize,total:W.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onPaginationChange:(e,s)=>{H(a=>({...a,current:e,pageSize:s})),J(e,s)},rowClassName:()=>"bg-slate-700 hover:bg-slate-600"})}),a.jsx(w,{title:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y,{className:"text-purple-400"}),a.jsx("span",{className:"text-white",children:G?"编辑用户":"创建用户"})]}),open:q,onCancel:()=>{K(!1),M(null),Q.resetFields()},onOk:()=>Q.submit(),width:600,className:"xiuxian-modal",children:a.jsxs(p,{form:Q,layout:"vertical",onFinish:async s=>{try{let a;a=G?await(async(s,a)=>{try{const t=await e({url:`/admin/users/${s}`,method:"PUT",data:a});return 200===t.code?{success:!0,message:t.message||"用户更新成功",data:t.data}:{success:!1,message:t.message||"用户更新失败"}}catch(t){return{success:!1,message:"错误，请重试"}}})(G.id,s):await(async s=>{try{const a=await e({url:"/admin/users",method:"POST",data:s});return 200===a.code?{success:!0,message:a.message||"用户创建成功",data:a.data}:{success:!1,message:a.message||"用户创建失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s),a.success?(b.success(G?"用户更新成功":"用户创建成功"),K(!1),Q.resetFields(),M(null),J(W.current,W.pageSize)):b.error(a.message||"操作失败")}catch(a){b.error("保存用户失败")}},className:"mt-4",children:[a.jsxs(S,{gutter:16,children:[a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"username",label:a.jsx("span",{className:"text-slate-300",children:"用户名"}),rules:[{required:!0,message:"请输入用户名"}],children:a.jsx(c,{placeholder:"请输入用户名",className:"xiuxian-input"})})}),a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"email",label:a.jsx("span",{className:"text-slate-300",children:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}],children:a.jsx(c,{placeholder:"请输入邮箱",className:"xiuxian-input"})})})]}),a.jsxs(S,{gutter:16,children:[a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"role",label:a.jsx("span",{className:"text-slate-300",children:"角色"}),rules:[{required:!0,message:"请选择角色"}],children:a.jsx(l,{placeholder:"请选择角色",className:"xiuxian-select",children:Object.values(r).filter(e=>"super_admin"!==e.role).map(e=>a.jsxs(A,{value:e.role,children:[e.icon," ",e.name]},e.role))})})}),a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"status",label:a.jsx("span",{className:"text-slate-300",children:"状态"}),rules:[{required:!0,message:"请选择状态"}],children:a.jsxs(l,{placeholder:"请选择状态",className:"xiuxian-select",children:[a.jsx(A,{value:"active",children:"正常"}),a.jsx(A,{value:"inactive",children:"未激活"}),a.jsx(A,{value:"suspended",children:"已暂停"})]})})})]}),a.jsxs(S,{gutter:16,children:[a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"realName",label:a.jsx("span",{className:"text-slate-300",children:"真实姓名"}),children:a.jsx(c,{placeholder:"请输入真实姓名",className:"xiuxian-input"})})}),a.jsx(N,{span:12,children:a.jsx(p.Item,{name:"department",label:a.jsx("span",{className:"text-slate-300",children:"部门"}),children:a.jsx(c,{placeholder:"请输入部门",className:"xiuxian-input"})})})]}),a.jsx(p.Item,{name:"phone",label:a.jsx("span",{className:"text-slate-300",children:"电话"}),children:a.jsx(c,{placeholder:"请输入电话",className:"xiuxian-input"})}),!G&&a.jsx(p.Item,{name:"password",label:a.jsx("span",{className:"text-slate-300",children:"密码"}),rules:[{required:!0,message:"请输入密码"}],children:a.jsx(c.Password,{placeholder:"请输入密码",className:"xiuxian-input"})})]})})]})}export{X as default};
