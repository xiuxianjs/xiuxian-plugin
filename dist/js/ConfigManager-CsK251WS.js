import{d as e,j as a,c as t}from"./index-D_MJe6zM.js";import{c as n}from"./config-BHbcfe-6.js";import{r as s}from"./react-vendor-BNT5GVrG.js";import{s as r}from"./index-BVTzMf5I.js";import"./XiuxianUserSelector-DASyPVze.js";import{X as l}from"./XiuxianPageWrapper-B1AdHBaw.js";import{X as o}from"./XiuxianPageTitle-BbilSi7y.js";import{X as i}from"./XiuxianTabGroup-6HGRfIfB.js";import{M as c}from"./index-BU49QM3r.js";import"./context-B-5eSelg.js";import"./index-Dw3SA_Op.js";const d=({name:e,description:n,type:s,value:r,onChange:l,className:o=""})=>a.jsxs("div",{className:`bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-xl p-4 shadow-lg ${o}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-white font-medium text-sm",children:e}),a.jsx("span",{className:t("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border",{string:"bg-blue-500/20 text-blue-400 border-blue-500/30",number:"bg-green-500/20 text-green-400 border-green-500/30",boolean:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",array:"bg-purple-500/20 text-purple-400 border-purple-500/30"}[s]),children:s.toUpperCase()})]}),a.jsx("p",{className:"text-slate-400 text-xs mb-3",children:n}),(()=>{switch(s){case"boolean":return a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:!!r,onChange:e=>l(e.target.checked),className:"w-4 h-4 text-purple-600 bg-slate-700 border-slate-600 rounded focus:ring-purple-500 focus:ring-2"}),a.jsx("span",{className:"ml-2 text-slate-300 text-sm",children:r?"启用":"禁用"})]});case"array":return a.jsx("textarea",{value:JSON.stringify(r||[],null,2),onChange:e=>{try{const a=JSON.parse(e.target.value);l(a)}catch(a){}},className:"w-full p-2 xiuxian-input text-xs font-mono rounded-lg",rows:3,placeholder:"请输入JSON数组格式"});default:return a.jsx("input",{type:"number"===s?"number":"text",value:String(r||""),onChange:e=>{const a="number"===s?parseFloat(e.target.value)||0:e.target.value;l(a)},className:"w-full p-2 xiuxian-input rounded-lg",placeholder:`请输入${e}`})}})()]}),u=()=>{const[a,t]=s.useState(null),[n,l]=s.useState(!1),[o,i]=s.useState("CD配置"),[c,d]=s.useState(""),[u,x]=s.useState(!1),m=async()=>{l(!0);try{const a=await(async a=>{try{return await e({url:"/config",params:{app:a}})}catch(t){return null}})("xiuxian");if(a){const e=a.data||a;t(e),d(JSON.stringify(e,null,2))}}catch(a){r.error("加载配置失败")}finally{l(!1)}};return s.useEffect(()=>{m()},[]),{config:a,loading:n,activeTab:o,setActiveTab:i,jsonConfig:c,setJsonConfig:d,message:r,loadConfig:m,handleSave:async a=>{l(!0);try{await(async(a,t)=>{try{return await e({url:"/config",method:"POST",data:{name:a,data:t}})}catch(n){return null}})("xiuxian",a),r.success("配置保存成功"),m()}catch(t){}finally{l(!1)}},handleConfigChange:(e,n)=>{if(!a)return;const s=e.split("."),r={...a};let l=r;for(let a=0;a<s.length-1;a++)l[s[a]]||(l[s[a]]={}),l=l[s[a]];l[s[s.length-1]]=n,t(r),d(JSON.stringify(r,null,2))},getConfigValue:e=>{if(!a)return;const t=e.split(".");let n=a;for(const a of t)n=null==n?void 0:n[a];return n},open:u,setOpen:x}};function x(){const{config:e,loading:t,activeTab:s,setActiveTab:r,jsonConfig:x,setJsonConfig:m,message:p,loadConfig:h,handleSave:g,handleConfigChange:f,getConfigValue:b,open:j,setOpen:y}=u(),N=n.map(e=>({name:e.name,icon:e.icon,content:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-white text-xl font-semibold flex items-center",children:[a.jsx("span",{className:"mr-2",children:e.icon}),e.name]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.items.map(e=>a.jsx(d,{name:e.name,description:e.description,type:"json"===e.type?"array":e.type,value:b(e.key),onChange:a=>f(e.key,a)},e.key))})]})}));return a.jsxs(l,{children:[a.jsx(o,{icon:"⚙️",title:"配置管理",subtitle:"管理系统配置参数",actions:a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:h,disabled:t,className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:[a.jsx("span",{className:"mr-2",children:"🔄"}),t?"刷新中...":"刷新配置"]}),a.jsxs("button",{onClick:()=>y(!0),className:"px-2 py-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-md hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:[a.jsx("span",{className:"mr-2",children:"🔄"}),"JSON编辑"]}),"JSON编辑"!==s&&a.jsxs("button",{onClick:()=>e&&g(e),disabled:t||!e,className:"px-2 py-1 rounded-md bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("span",{className:"mr-2",children:"💾"}),t?"保存中...":"保存配置"]})]})}),a.jsx(i,{tabs:N,activeTab:s,onTabChange:r}),a.jsx(c,{className:"xiuxian-modal",title:"JSON配置",open:j,onCancel:()=>y(!1),onOk:()=>{try{const e=JSON.parse(x);g(e),y(!1)}catch(e){p.error("JSON格式错误")}},cancelText:"取消",okText:"确定",children:a.jsx("div",{children:a.jsx("div",{className:"mb-4",children:a.jsx("textarea",{value:x,onChange:e=>m(e.target.value),className:"w-full h-96 p-4 xiuxian-input rounded-xl font-mono text-sm",placeholder:"请输入JSON格式的配置..."})})})})]})}export{x as default};
