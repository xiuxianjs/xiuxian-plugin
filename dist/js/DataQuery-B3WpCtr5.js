import{n as e,p as a,o as s}from"./index-D64fSWen.js";import{r as t}from"./react-vendor-B_j1QKL9.js";import{p as n}from"./config-C-P0NNBq.js";import{s as i}from"./index-CNd4JuwY.js";import{M as l}from"./index-yWgYGWn4.js";import{T as r}from"./index-OFQobG-o.js";import{S as c}from"./index-BVzpzorU.js";import{B as o}from"./EllipsisOutlined-B7G7Lika.js";import{R as d}from"./PlusOutlined-BzVVLDjU.js";import{C as h}from"./AntdIcon-BrIVTVC9.js";import{S as u,P as m,C as p,E as g,F as x}from"./Table-CcmlabOw.js";import{I as j}from"./index-Ba3ggKkW.js";import{R as f}from"./DeleteOutlined-BGdJH0Vj.js";import{R as y}from"./CloseOutlined-B--xzqQ7.js";import{R as S}from"./SaveOutlined-BoOqeck_.js";import{R as v}from"./EditOutlined-BSaIuPsK.js";import{S as b}from"./index-DYUhiIpg.js";import{T as C}from"./index-DpPhw_8z.js";import{R as N}from"./ReloadOutlined-st9QP56F.js";import{R as w,C as T}from"./row-KUrmra0O.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./InfoCircleFilled-CZmHaujc.js";import"./context-C6B8do_o.js";import"./DownOutlined-CLoAI_il.js";import"./EditOutlined-jOoJX1ad.js";import"./CheckOutlined-BLh5wKOq.js";import"./index-ChgZ5ieq.js";import"./TextArea-RvXwFgUf.js";import"./index-GvAVA_fY.js";const k={Talent:"灵根列表",Monster:"怪物列表",Commodity:"商品列表",Level1:"练气境界",ScoreShop:"积分商城",Level2:"炼体境界",Equipment:"装备列表",Danyao:"丹药列表",NewDanyao:"炼丹师丹药",Daoju:"道具列表",Gongfa:"功法列表",Caoyao:"草药列表",Didian:"地点列表",Bless:"洞天福地",GuildSecrets:"宗门秘境",ForbiddenArea:"禁地列表",FairyRealm:"仙境列表",TimePlace:"限定仙府",TimeGongfa:"限定功法",TimeEquipment:"限定装备",TimeDanyao:"限定丹药",Occupation:"职业列表",experience:"经验配置",Danfang:"炼丹配方",Tuzhi:"装备图纸",Bapin:"八品",Xingge:"星阁拍卖行",Tianditang:"天地堂",Changzhuxianchon:"常驻仙宠",Xianchon:"仙宠列表",Xianchonkouliang:"仙宠口粮",NPC:"NPC列表",Shop:"商店列表",Qinglong:"青龙",Qilin:"麒麟",Xuanwu:"玄武朱雀白虎",Mojie:"魔界列表",ExchangeItem:"兑换列表",Shenjie:"神界列表",Jineng1:"技能列表1",Jineng2:"技能列表2",Qianghua:"强化列表",Duanzhaocailiao:"锻造材料",Duanzhaowuqi:"锻造武器",Duanzhaohuju:"锻造护具",Duanzhaobaowu:"锻造宝物",Yincang:"隐藏灵根",Zalei:"锻造杂类",Jineng:"技能列表",UpdateRecord:"更新记录"},z=()=>{const{user:l}=a(),[r]=t.useState(Object.keys(k)),[c,o]=t.useState(""),[d,h]=t.useState([]),[u,m]=t.useState(!1),[p,g]=t.useState(""),[x,j]=t.useState(!1),[f,y]=t.useState([]),[S,v]=t.useState({current:1,pageSize:n,total:0}),b=async(a,s=1,t=n)=>{if(a&&l){m(!0);try{if(!localStorage.getItem("token"))return i.error("未找到登录令牌"),void h([]);const n=await(async(a,s={})=>{var t,n;try{const i=await e({url:"/data-list",method:"GET",params:{name:a,page:null==(t=s.page)?void 0:t.toString(),pageSize:null==(n=s.pageSize)?void 0:n.toString(),search:s.search}});return 200===i.code?{success:!0,data:i.data}:{success:!1,message:i.message||"获取数据失败"}}catch(i){return{success:!1,message:"获取数据失败"}}})(a,{page:s,pageSize:t,search:p});n.success&&n.data?(h(n.data.list??[]),v({current:n.data.pagination.current,pageSize:n.data.pagination.pageSize,total:n.data.pagination.total})):(i.error(n.message??"获取数据失败"),h([]))}catch(r){i.error("获取数据失败"),h([])}finally{m(!1)}}},C=e=>{o(e),v(e=>({...e,current:1})),e?b(e,1,S.pageSize):(h([]),v(e=>({...e,total:0})))},N=e=>{},w=t.useMemo(()=>{if(!(null==d?void 0:d.length))return[];const e=d[0];return Object.keys(e).map(e=>({title:e,dataIndex:e,key:e,width:150,ellipsis:!0,render:e=>"object"==typeof e?s.jsxs("span",{className:"text-blue-400 cursor-pointer",onClick:()=>{},children:[JSON.stringify(e).substring(0,50),"..."]}):"boolean"==typeof e?s.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(e?"bg-green-500/20":"bg-red-500/20"),children:e?"是":"否"}):"number"==typeof e?s.jsx("span",{className:"text-green-400",children:e.toLocaleString()}):s.jsx("span",{className:"",children:String(e)})}))},[d]);return t.useEffect(()=>{r.length>0&&!c&&C(r[0])},[r]),{dataTypes:r,selectedDataType:c,dataList:d,loading:u,searchText:p,pagination:S,columns:w,editModalVisible:x,originalData:f,handleDataTypeChange:C,handleSearch:e=>{g(e),c&&b(c,1,S.pageSize)},handleTableChange:(e,a)=>{v(s=>({...s,current:e,pageSize:a})),c&&b(c,e,a)},handleRefresh:()=>{c&&b(c,S.current,S.pageSize)},handleViewDetail:N,handleEdit:()=>{c?d&&0!==d.length?(y(d),j(!0)):i.warning("当前没有可编辑的数据"):i.warning("请先选择数据类型")},handleEditSuccess:()=>{c&&b(c,S.current,S.pageSize)},handleEditCancel:()=>{j(!1),y([])},getDataTypeDisplayName:e=>k[e]??e}},{TextArea:D}=j,{Text:O}=r,{Option:E}=u;function $({visible:a,onCancel:n,onSuccess:r,dataType:x,dataTypeName:N,originalData:w}){const[T,k]=t.useState(!1),[z,$]=t.useState([]),[R,J]=t.useState([]),[M,I]=t.useState(1),[Q,q]=t.useState(10),[F,P]=t.useState([]),[A,G]=t.useState(!1),[L,B]=t.useState(""),[V,X]=t.useState("");t.useEffect(()=>{var e;if(w.length>0){const a=w[0],s=Object.keys(a).map(e=>{const s=a[e];let t="string";return"number"==typeof s?t="number":"boolean"==typeof s?t="boolean":"object"==typeof s?t="json":"string"==typeof s&&s.length>100&&(t="textarea"),{key:e,label:e,type:t,required:!1}});J(s),$([...w]),B((null==(e=s[0])?void 0:e.key)??"")}},[w]);const U=z.slice((M-1)*Q,M*Q),H=(e,a,t)=>{const n=a=>{((e,a,s)=>{const t=[...z],n=(M-1)*Q+e;t[n]={...t[n],[a]:s},$(t)})(t,e.key,a)};switch(e.type){case"number":return s.jsx(C,{value:a,onChange:n,className:"w-full",placeholder:`请输入${e.label}`});case"boolean":return s.jsx(b,{checked:a,onChange:n,checkedChildren:"是",unCheckedChildren:"否"});case"textarea":return s.jsx(D,{value:a,onChange:e=>n(e.target.value),rows:3,placeholder:`请输入${e.label}`});case"json":return s.jsx(D,{value:"object"==typeof a?JSON.stringify(a,null,2):String(a),onChange:e=>{try{const a=JSON.parse(e.target.value);n(a)}catch{n(e.target.value)}},rows:4,placeholder:`请输入${e.label} (JSON格式)`});default:return s.jsx(j,{value:String(a),onChange:e=>n(e.target.value),placeholder:`请输入${e.label}`})}},K=async()=>{k(!0);try{if(!localStorage.getItem("token"))return void i.error("未找到登录令牌");const a=await(async(a,s,t=!1)=>{try{const n=await e({url:"/data-list",method:"PUT",data:{name:a,data:s,batchMode:t}});return 200===n.code?{success:!0,data:n.data}:{success:!1,message:n.message||"更新数据失败"}}catch(n){return{success:!1,message:"更新数据失败"}}})(x,z);a.success?(i.success("数据保存成功"),r(),n()):i.error(a.message??"保存失败")}catch(a){i.error("保存数据失败")}finally{k(!1)}};return s.jsx(l,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{})," ",s.jsxs("span",{children:["编辑 ",N]})]}),open:a,onCancel:n,width:"95%",style:{top:20},className:"",footer:[s.jsx(o,{onClick:n,icon:s.jsx(y,{}),children:"取消"},"cancel"),s.jsx(o,{type:"primary",loading:T,onClick:()=>{K()},icon:s.jsx(S,{}),children:"保存"},"save")],children:s.jsxs("div",{className:"max-h-[70vh] overflow-y-auto",children:[s.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(O,{children:["共 ",z.length," 条数据，当前页 ",U.length," 条"]}),s.jsxs(O,{children:["已选择 ",F.length," 行"]})]}),s.jsxs(c,{children:[s.jsx(o,{type:"primary",onClick:()=>{if(w.length>0){const e=Object.keys(w[0]).reduce((e,a)=>(e[a]="",e),{});$([...z,e]);const a=Math.ceil((z.length+1)/Q);I(a)}},icon:s.jsx(d,{}),children:"添加行"}),s.jsx(o,{onClick:()=>G(!A),type:A?"primary":"default",children:"批量操作"})]})]}),A&&s.jsx(h,{className:"mb-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(O,{strong:!0,children:"批量更新："}),s.jsx(u,{value:L,onChange:B,style:{width:150},placeholder:"选择字段",children:R.map(e=>s.jsx(E,{value:e.key,children:e.label},e.key))}),s.jsx(j,{value:V,onChange:e=>X(e.target.value),placeholder:"输入新值",style:{width:200}}),s.jsxs(o,{type:"primary",onClick:()=>{if(0===F.length)return void i.warning("请先选择要更新的行");if(!L)return void i.warning("请选择要更新的字段");const e=[...z];F.forEach(a=>{e[a]&&(e[a]={...e[a],[L]:V})}),$(e),P([]),G(!1),i.success(`已批量更新 ${F.length} 行数据`)},disabled:0===F.length,children:["批量更新 (",F.length,")"]})]})}),s.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{children:"每页显示："}),s.jsxs(u,{value:Q,onChange:e=>{q(e),I(1)},style:{width:80},children:[s.jsx(E,{value:5,children:"5条"}),s.jsx(E,{value:10,children:"10条"}),s.jsx(E,{value:20,children:"20条"}),s.jsx(E,{value:50,children:"50条"})]})]}),s.jsx(m,{current:M,pageSize:Q,total:z.length,showSizeChanger:!1,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`,onChange:e=>I(e)})]}),s.jsx("div",{className:"space-y-4",children:U.map((e,a)=>{const t=(M-1)*Q+a,n=F.includes(t);return s.jsx(h,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{checked:n,onChange:()=>(e=>{const a=(M-1)*Q+e,s=F.includes(a)?F.filter(e=>e!==a):[...F,a];P(s)})(a)}),s.jsxs("span",{children:["第 ",t+1," 条数据"]})]}),size:"small",className:"border",extra:s.jsx(o,{type:"text",danger:!0,size:"small",icon:s.jsx(f,{}),onClick:()=>(e=>{const a=(M-1)*Q+e,s=z.filter((e,s)=>s!==a);$(s);const t=Math.ceil(s.length/Q);M>t&&t>0&&I(t)})(a),children:"删除"}),children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(t=>s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"block text-sm font-medium",children:[t.label,t.required&&s.jsx("span",{className:"ml-1",children:"*"})]}),H(t,e[t.key],a)]},t.key))})},t)})}),0===U.length&&s.jsx("div",{className:"text-center py-8",children:s.jsx(g,{description:"当前页暂无数据"})}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsx(m,{current:M,pageSize:Q,total:z.length,showSizeChanger:!1,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`,onChange:e=>I(e)})})]})})}const{Option:R}=u,{Search:J}=j;function M(){const{dataTypes:e,selectedDataType:a,dataList:t,loading:n,searchText:i,pagination:l,columns:r,editModalVisible:d,originalData:m,handleDataTypeChange:p,handleSearch:g,handleTableChange:j,handleRefresh:f,handleEdit:y,handleEditSuccess:S,handleEditCancel:b,getDataTypeDisplayName:C}=z();return s.jsxs("div",{className:"min-h-screen bg-gray-200 p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold m-0",children:"数据查询"}),s.jsx("p",{className:"text-sm mt-2 mb-0",children:"查询和浏览游戏中的各种数据列表"})]}),s.jsxs(c,{children:[s.jsx(o,{icon:s.jsx(v,{}),onClick:y,disabled:!a,children:"编辑数据"}),s.jsx(o,{icon:s.jsx(N,{spin:n}),onClick:f,loading:n,children:"刷新数据"})]})]}),s.jsx(h,{title:"查询条件",className:"mb-6",children:s.jsxs(w,{gutter:16,children:[s.jsx(T,{span:12,children:s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-2",children:"数据类型"}),s.jsx(u,{value:a,onChange:p,placeholder:"请选择数据类型",className:"w-full",children:e.map(e=>s.jsx(R,{value:e,children:C(e)},e))})]})}),s.jsx(T,{span:12,children:s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-2",children:"搜索关键词"}),s.jsx(J,{placeholder:"输入关键词搜索...",value:i,onChange:e=>g(e.target.value),onSearch:g})]})})]})}),s.jsx(h,{title:a?C(a):"数据列表",children:s.jsx(x,{columns:r,dataSource:t,rowKey:(e,a)=>(null==a?void 0:a.toString())??"0",loading:n,pagination:{current:l.current,pageSize:l.pageSize,total:l.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`,onChange:j},scroll:{x:1200}})}),s.jsx($,{visible:d,onCancel:b,onSuccess:S,dataType:a,dataTypeName:a?C(a):"",originalData:m})]})}export{M as default};
