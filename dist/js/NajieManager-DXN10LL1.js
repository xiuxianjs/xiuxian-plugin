import{a as e,j as a,u as s}from"./index-1Buk7MHt.js";import"./index-Cy_K9d2s.js";import{I as t,B as l}from"./XiuxianUserSelector-BMQSkCjs.js";import{X as r}from"./XiuxianInfoCard-e3nPPD7E.js";import{r as i}from"./react-vendor-a03lyGlx.js";import{M as n}from"./index-wAhsvofi.js";import{R as o}from"./SearchOutlined-CGV9B64O.js";import{F as d}from"./index-B6EMR5lY.js";import{C as c,R as x}from"./index-CpR1QwKE.js";import{R as h,C as m}from"./row-CtRU1SjW.js";import{T as u,R as g}from"./index-BbQ-lTEv.js";import{T as j}from"./index-D9ywTypt.js";import{R as p}from"./SaveOutlined-BEXKfORr.js";import{s as b}from"./index-CM58c4md.js";import{R as v}from"./DeleteOutlined-DgqvVLe4.js";import{p as f}from"./config-BU5eskQO.js";import{X as N,a as y}from"./XiuxianPageTitle-ClGkPvjU.js";import{X as w}from"./XiuxianSearchBar-BL_qcT4k.js";import{I as k,X as S,T as I}from"./XiuxianTableContainer-Ck0rxAnn.js";import{X as C}from"./XiuxianRefreshButton-j6mRwBxx.js";import{X as T}from"./XiuxianTableWithPagination-Dlo1fuVA.js";import{R as D}from"./EyeOutlined-CLanTFnW.js";import"./reactNode-CNKl2Mmk.js";import"./context-Be8oxecN.js";import"./extendsObject-C6YrUve6.js";import"./index-DdhvtcVO.js";import"./Table-D7hXmRTc.js";import"./index-BMwxKtRD.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},z.apply(this,arguments)}const E=(e,a)=>i.createElement(k,z({},e,{ref:a,icon:V})),X=i.forwardRef(E),B=({najieDetailVisible:e,setNajieDetailVisible:s,selectedNajie:t,getTotalItems:l})=>{var i,d,c,x,h,m,u,g,j;return a.jsx(n,{title:a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"text-xl font-bold text-white",children:"corrupted"===(null==t?void 0:t.数据状态)?"损坏数据详情":"背包详情"})}),open:e,onCancel:()=>s(!1),footer:null,closeIcon:a.jsx(o,{className:"text-white"}),className:"xiuxian-modal",width:"corrupted"===(null==t?void 0:t.数据状态)?1200:800,children:t&&a.jsx("div",{className:"space-y-6",children:"corrupted"===t.数据状态?a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 text-red-400 flex items-center gap-2",children:[a.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),"损坏数据 - 原始JSON内容"]}),a.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-pink-500/10 backdrop-blur-xl border border-red-500/30 rounded-xl p-4",children:[a.jsxs("p",{className:"text-sm text-red-300 mb-2",children:["错误信息: ",t.错误信息]}),a.jsx("pre",{className:"text-xs text-slate-300 overflow-auto max-h-96 bg-slate-800/50 p-3 rounded-lg border border-slate-700/50",children:t.原始数据})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[a.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),"基础信息"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(r,{label:"用户ID",value:t.userId,gradient:"blue"}),a.jsx(r,{label:"背包等级",value:t.等级||1,gradient:"green"}),a.jsx(r,{label:"总物品数",value:l(t),gradient:"purple"}),a.jsx(r,{label:"当前灵石",value:`${(null==(i=t.灵石)?void 0:i.toLocaleString())||0}`,gradient:"green"})]})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[a.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),"物品统计"]}),a.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[a.jsx(r,{label:"装备",value:(null==(d=t.装备)?void 0:d.length)||0,gradient:"blue"}),a.jsx(r,{label:"丹药",value:(null==(c=t.丹药)?void 0:c.length)||0,gradient:"green"}),a.jsx(r,{label:"道具",value:(null==(x=t.道具)?void 0:x.length)||0,gradient:"purple"}),a.jsx(r,{label:"功法",value:(null==(h=t.功法)?void 0:h.length)||0,gradient:"orange"})]})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[a.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),"其他物品"]}),a.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[a.jsx(r,{label:"草药",value:(null==(m=t.草药)?void 0:m.length)||0,gradient:"green"}),a.jsx(r,{label:"材料",value:(null==(u=t.材料)?void 0:u.length)||0,gradient:"yellow"}),a.jsx(r,{label:"仙宠",value:(null==(g=t.仙宠)?void 0:g.length)||0,gradient:"pink"}),a.jsx(r,{label:"灵石上限",value:`${(null==(j=t.灵石上限)?void 0:j.toLocaleString())||0}`,gradient:"blue"})]})]})]})})})},O=[{key:"装备",label:"装备",color:"from-blue-500/10 to-cyan-500/10"},{key:"丹药",label:"丹药",color:"from-red-500/10 to-pink-500/10"},{key:"道具",label:"道具",color:"from-green-500/10 to-emerald-500/10"},{key:"功法",label:"功法",color:"from-purple-500/10 to-pink-500/10"},{key:"草药",label:"草药",color:"from-yellow-500/10 to-orange-500/10"},{key:"材料",label:"材料",color:"from-indigo-500/10 to-purple-500/10"},{key:"仙宠",label:"仙宠",color:"from-pink-500/10 to-rose-500/10"},{key:"仙宠口粮",label:"仙宠口粮",color:"from-amber-500/10 to-yellow-500/10"}];function R({visible:e,onCancel:s,onSave:r,najie:o,loading:g=!1}){const[f]=d.useForm(),[N,y]=i.useState(null),[w,k]=i.useState("");i.useEffect(()=>{e&&o&&(y({...o}),f.setFieldsValue({userId:o.userId,"灵石":o.灵石,"灵石上限":o.灵石上限,"等级":o.等级}))},[e,o,f]);const S=(e,a,s,t)=>{if(!N)return;const l=(N[e]||[]).map((e,l)=>l===a?{...e,[s]:t}:e);y({...N,[e]:l})},I=(e,s,r)=>a.jsx(c,{className:"bg-gradient-to-br from-slate-700/50 to-slate-800/50 border border-slate-600/50 mb-3",size:"small",children:a.jsxs(h,{gutter:[8,8],children:[a.jsxs(m,{span:8,children:[a.jsx(t,{placeholder:"物品名称",value:e.name,onChange:e=>S(s,r,"name",e.target.value),className:"xiuxian-input"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/0 to-pink-500/0 group-hover:from-purple-500/10 group-hover:to-pink-500/10 transition-all duration-300"})]}),a.jsx(m,{span:4,children:a.jsx(t,{placeholder:"品质",value:e.grade,onChange:e=>S(s,r,"grade",e.target.value),className:"xiuxian-input"})}),a.jsx(m,{span:3,children:a.jsx(u,{placeholder:"品级",value:e.pinji,onChange:e=>S(s,r,"pinji",e),className:"w-full xiuxian-input",min:1})}),a.jsx(m,{span:3,children:a.jsx(u,{placeholder:"数量",value:e.数量,onChange:e=>S(s,r,"数量",e),className:"w-full bg-slate-600/50 border-slate-500 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:1})}),a.jsx(m,{span:3,children:a.jsx(u,{placeholder:"攻击",value:e.atk,onChange:e=>S(s,r,"atk",e),className:"w-full bg-slate-600/50 border-slate-500 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900"})}),a.jsx(m,{span:3,children:a.jsx(l,{type:"text",danger:!0,icon:a.jsx(v,{}),onClick:()=>((e,a)=>{if(!N)return;const s=(N[e]||[]).filter((e,s)=>s!==a);y({...N,[e]:s})})(s,r),className:"text-red-400 hover:text-red-300"})})]})},r);return a.jsx(n,{title:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xl font-bold text-white",children:"编辑背包"}),a.jsxs("span",{className:"text-slate-300",children:["用户ID: ",null==o?void 0:o.userId]})]}),open:e,onCancel:s,width:1200,footer:[a.jsx(l,{onClick:s,className:"bg-slate-600 border-slate-500 text-white",children:"取消"},"cancel"),a.jsx(l,{type:"primary",icon:a.jsx(p,{}),onClick:async()=>{try{const e=await f.validateFields();if(N){const a={...N,userId:e.userId,"灵石":e.灵石,"灵石上限":e.灵石上限,"等级":e.等级};r(a)}}catch(e){}},loading:g,className:"bg-gradient-to-r from-purple-500 to-pink-500 border-0",children:"保存"},"save")],className:"najie-edit-modal xiuxian-modal",children:a.jsxs("div",{className:"space-y-6",children:[a.jsx(c,{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-slate-700/50",children:a.jsx(d,{form:f,layout:"vertical",children:a.jsxs(h,{gutter:16,children:[a.jsx(m,{span:8,children:a.jsx(d.Item,{label:a.jsx("span",{className:"text-slate-200",children:"用户ID"}),name:"userId",rules:[{required:!0,message:"请输入用户ID"}],children:a.jsx(t,{className:"bg-slate-700/50 border-slate-600 text-white placeholder-slate-400 hover:bg-white hover:text-gray-900 hover:placeholder-gray-500 focus:bg-white focus:text-gray-900 focus:placeholder-gray-500"})})}),a.jsx(m,{span:8,children:a.jsx(d.Item,{label:a.jsx("span",{className:"text-slate-200",children:"灵石"}),name:"灵石",rules:[{required:!0,message:"请输入灵石数量"}],children:a.jsx(u,{className:"w-full bg-slate-700/50 border-slate-600 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||""})})}),a.jsx(m,{span:8,children:a.jsx(d.Item,{label:a.jsx("span",{className:"text-slate-200",children:"灵石上限"}),name:"灵石上限",children:a.jsx(u,{className:"w-full bg-slate-700/50 border-slate-600 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||""})})})]})})}),a.jsx(j,{type:"card",className:"najie-tabs xiuxian-tabs",tabBarStyle:{backgroundColor:"rgba(30, 41, 59, 0.8)",borderBottom:"1px solid rgba(71, 85, 105, 0.5)"},tabBarGutter:8,items:O.map(e=>{var s;return{key:e.key,label:a.jsxs("span",{className:"text-white hover:text-purple-300 transition-colors",children:[e.label," (",(null==(s=null==N?void 0:N[e.key])?void 0:s.length)||0,")"]}),children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-bold text-white",children:e.label}),a.jsxs("div",{className:"flex gap-6",children:[a.jsx(t,{value:w,onChange:e=>k(e.target.value),className:"max-w-40 xiuxian-input"}),a.jsx(l,{type:"primary",icon:a.jsx(x,{}),onClick:()=>(e=>{if(!w)return;if(!N)return;if(N[e].some(e=>e.name===w))return void b.error("已存在该物品");const a={name:w,grade:"",pinji:1,"数量":1};y({...N,[e]:[...N[e]||[],a]})})(e.key),className:"bg-gradient-to-r from-green-500 to-emerald-500 border-0",children:"添加物品"})]})]}),a.jsx("div",{className:"space-y-2",children:((null==N?void 0:N[e.key])||[]).map((a,s)=>I(a,e.key,s))}),(()=>{const a=null==N?void 0:N[e.key];return!a||!Array.isArray(a)||0===a.length})()&&a.jsxs("div",{className:"text-center py-8 text-slate-400",children:["暂无",e.label,"，点击上方按钮添加"]})]})}})})]})})}const L=()=>{const{user:a}=s(),[t,l]=i.useState([]),[r,n]=i.useState(!1),[o,d]=i.useState(""),[c,x]=i.useState(null),[h,m]=i.useState(!1),[u,g]=i.useState(!1),[j,p]=i.useState(!1),[v,N]=i.useState({current:1,pageSize:f,total:0,totalPages:0}),y=async(s=1,t=f)=>{if(a){n(!0);try{const a=localStorage.getItem("token");if(!a)return void b.error("未找到登录令牌");const r=await(async(a,s={})=>{try{const a=await e({url:"/najie",method:"GET",params:s});return 200===a.code?{success:!0,data:a.data}:{success:!1,message:a.message}}catch(t){return{success:!1,message:"网络错误"}}})(0,{page:s,pageSize:t,search:o});r.success&&r.data?(l(r.data.list),N(r.data.pagination)):b.error(r.message||"获取背包数据失败")}catch(r){b.error("获取背包数据失败")}finally{n(!1)}}};i.useEffect(()=>{y(1,f)},[a]);return{najieList:t,loading:r,searchText:o,selectedNajie:c,najieDetailVisible:h,najieEditVisible:u,editLoading:j,pagination:v,fetchNajie:y,handleSearchAndFilter:()=>{y(1,v.pageSize)},handleTableChange:(e,a)=>{y(e,a)},handleEditNajie:e=>{x(e),g(!0)},handleSaveNajie:async a=>{p(!0);try{const s=localStorage.getItem("token");if(!s)return void b.error("未找到登录令牌");const t=await(async(a,s)=>{try{const a=await e({url:"/najie",method:"PUT",data:s});return 200===a.code?{success:!0,message:a.message||"纳戒信息更新成功"}:{success:!1,message:a.message||"纳戒信息更新失败"}}catch(t){return{success:!1,message:"更新纳戒信息失败"}}})(0,a);t.success?(b.success("背包更新成功"),g(!1),y(v.current,v.pageSize)):b.error(t.message||"背包更新失败")}catch(s){b.error("背包更新失败")}finally{p(!1)}},getTotalItems:e=>["装备","丹药","道具","功法","草药","材料","仙宠","仙宠口粮"].reduce((a,s)=>a+(Array.isArray(e[s])?e[s].length:0),0),setSearchText:d,setSelectedNajie:x,setNajieDetailVisible:m,setNajieEditVisible:g}};function $(){const{najieList:e,loading:s,searchText:t,selectedNajie:l,najieDetailVisible:r,najieEditVisible:i,editLoading:n,pagination:o,fetchNajie:d,handleSearchAndFilter:c,handleTableChange:x,handleEditNajie:h,handleSaveNajie:m,getTotalItems:u,setSearchText:j,setSelectedNajie:p,setNajieDetailVisible:b,setNajieEditVisible:v}=L(),f=[{title:a.jsx("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:a.jsx("span",{children:"用户信息"})}),key:"userInfo",width:150,render:(e,s)=>a.jsxs("div",{children:[a.jsxs("div",{className:"font-bold text-white",children:["用户ID: ",s.userId]}),a.jsxs("div",{className:"text-xs text-slate-400",children:["背包等级: ",s.等级||1]})]})},{title:a.jsx("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:a.jsx("span",{children:"灵石信息"})}),key:"lingshi",width:120,render:(e,s)=>{var t,l;return a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-green-500",children:["当前: ",(null==(t=s.灵石)?void 0:t.toLocaleString())||0]}),a.jsxs("div",{className:"text-xs text-yellow-500",children:["上限: ",(null==(l=s.灵石上限)?void 0:l.toLocaleString())||0]})]})}},{title:a.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:a.jsx("span",{children:"物品统计"})}),key:"items",width:200,render:(e,s)=>{var t,l,r;return a.jsxs("div",{children:[a.jsxs("div",{className:"text-xs text-slate-300",children:["总物品: ",u(s)]}),a.jsxs("div",{className:"text-xs text-slate-300",children:["装备: ",(null==(t=s.装备)?void 0:t.length)||0]}),a.jsxs("div",{className:"text-xs text-slate-300",children:["丹药: ",(null==(l=s.丹药)?void 0:l.length)||0]}),a.jsxs("div",{className:"text-xs text-slate-300",children:["道具: ",(null==(r=s.道具)?void 0:r.length)||0]})]})}},{title:a.jsx("div",{className:"flex items-center gap-2 text-yellow-400 font-bold",children:a.jsx("span",{children:"操作"})}),key:"actions",width:120,render:(e,s)=>a.jsxs("div",{className:"flex gap-2",children:[a.jsx(I,{title:"查看详情",children:a.jsx("button",{className:"p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>{p(s),b(!0)},children:a.jsx(D,{className:"text-lg"})})}),a.jsx(I,{title:"编辑背包",children:a.jsx("button",{className:"p-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>h(s),children:a.jsx(g,{className:"text-lg"})})})]})}];return a.jsxs(N,{children:[a.jsx(y,{icon:a.jsx(X,{}),title:"背包管理",subtitle:"管理修仙界道友的背包物品",actions:a.jsx(C,{loading:s,onClick:()=>d(1,o.pageSize)})}),a.jsx(w,{placeholder:"搜索用户ID",value:t,onChange:j,onSearch:c,onKeyPress:e=>"Enter"===e.key&&c(),className:"mb-6"}),a.jsx(S,{title:"背包列表",icon:a.jsx(X,{}),children:a.jsx(T,{columns:f,dataSource:e,rowKey:"userId",loading:s,rowClassName:e=>"corrupted"===e.数据状态?"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border-l-4 border-yellow-400  bg-slate-700 hover:bg-slate-600":"hover:bg-gradient-to-r hover:from-purple-500/10 hover:to-blue-500/10 transition-all duration-300 bg-slate-700 hover:bg-slate-600",pagination:{current:o.current,pageSize:o.pageSize,total:o.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`},onPaginationChange:x,scroll:{x:1200}})}),a.jsx(B,{najieDetailVisible:r,setNajieDetailVisible:b,selectedNajie:l,getTotalItems:u}),a.jsx(R,{visible:i,onCancel:()=>v(!1),onSave:m,najie:l,loading:n})]})}export{$ as default};
