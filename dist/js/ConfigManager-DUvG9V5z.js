import{n as e,o as s}from"./index-D64fSWen.js";import{c as n}from"./config-C-P0NNBq.js";import{r as a}from"./react-vendor-B_j1QKL9.js";import{s as t}from"./index-CNd4JuwY.js";import{S as i}from"./index-BVzpzorU.js";import{B as r}from"./EllipsisOutlined-B7G7Lika.js";import{R as l}from"./ReloadOutlined-st9QP56F.js";import{R as o}from"./EditOutlined-BSaIuPsK.js";import{R as c}from"./SaveOutlined-BoOqeck_.js";import{C as m,T as d}from"./AntdIcon-BrIVTVC9.js";import{M as x}from"./index-yWgYGWn4.js";import{I as j}from"./index-Ba3ggKkW.js";import{T as p}from"./index-DU3lSUt0.js";import{S as f}from"./index-DYUhiIpg.js";import{T as h}from"./index-DpPhw_8z.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./InfoCircleFilled-CZmHaujc.js";import"./EditOutlined-jOoJX1ad.js";import"./context-C6B8do_o.js";import"./DownOutlined-CLoAI_il.js";import"./TextArea-RvXwFgUf.js";const u=()=>{const[s,n]=a.useState(null),[i,r]=a.useState(!1),[l,o]=a.useState("CD配置"),[c,m]=a.useState(""),[d,x]=a.useState(!1),j=async()=>{r(!0);try{const s=await(async s=>{try{return await e({url:"/config",params:{app:s}})}catch(n){return null}})("xiuxian");if(s){const e=s.data||s;n(e),m(JSON.stringify(e,null,2))}}catch(s){t.error("加载配置失败")}finally{r(!1)}};return a.useEffect(()=>{j()},[]),{config:s,loading:i,activeTab:l,setActiveTab:o,jsonConfig:c,setJsonConfig:m,message:t,loadConfig:j,handleSave:async s=>{r(!0);try{await(async(s,n)=>{try{return await e({url:"/config",method:"POST",data:{name:s,data:n}})}catch(a){return null}})("xiuxian",s),t.success("配置保存成功"),j()}catch(n){}finally{r(!1)}},handleConfigChange:(e,a)=>{var t;if(!s)return;const i=e.split("."),r={...s};let l=r;for(let s=0;s<i.length-1;s++)l[t=i[s]]??(l[t]={}),l=l[i[s]];l[i[i.length-1]]=a,n(r),m(JSON.stringify(r,null,2))},getConfigValue:e=>{if(!s)return;const n=e.split(".");let a=s;for(const s of n)a=null==a?void 0:a[s];return a},open:d,setOpen:x}},{TextArea:g}=j;function y(){const{config:e,loading:a,activeTab:t,setActiveTab:y,jsonConfig:C,setJsonConfig:N,message:v,loadConfig:S,handleSave:O,handleConfigChange:b,getConfigValue:J,open:k,setOpen:w}=u(),T=n.map(e=>({key:e.name,label:s.jsxs("span",{children:[e.icon&&s.jsx("span",{className:"mr-2",children:e.icon}),e.name]}),children:s.jsxs("div",{children:[s.jsxs("h3",{className:"mb-4 text-lg font-semibold",children:[e.icon&&s.jsx("span",{className:"mr-2",children:e.icon}),e.name]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.items.map(e=>(e=>{const n=J(e.key),a="json"===e.type?"array":e.type;return s.jsxs(m,{size:"small",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"font-medium",children:e.name}),s.jsx(p,{children:a.toUpperCase()})]}),s.jsx("p",{className:"text-xs mb-3",children:e.description}),"boolean"===a?s.jsxs("div",{children:[s.jsx(f,{checked:!!n,onChange:s=>b(e.key,s)}),s.jsx("span",{className:"ml-2",children:n?"启用":"禁用"})]}):"array"===a?s.jsx(g,{value:JSON.stringify(n??[],null,2),onChange:s=>{try{const n=JSON.parse(s.target.value);b(e.key,n)}catch(n){}},rows:3,placeholder:"请输入JSON数组格式",className:"font-mono text-xs"}):"number"===a?s.jsx(h,{value:n,onChange:s=>b(e.key,s??0),className:"w-full",placeholder:`请输入${e.name}`}):s.jsx(j,{value:String(n??""),onChange:s=>b(e.key,s.target.value),placeholder:`请输入${e.name}`})]},e.key)})(e))})]})}));return s.jsxs("div",{className:"min-h-screen bg-gray-200 p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold m-0",children:"配置管理"}),s.jsx("p",{className:"text-sm mt-2 mb-0",children:"管理系统配置参数"})]}),s.jsxs(i,{wrap:!0,children:[s.jsx(r,{icon:s.jsx(l,{spin:a}),onClick:()=>{S()},disabled:a,children:a?"刷新中...":"刷新配置"}),s.jsx(r,{icon:s.jsx(o,{}),onClick:()=>w(!0),children:"JSON编辑"}),"JSON编辑"!==t&&s.jsx(r,{type:"primary",icon:s.jsx(c,{}),onClick:()=>{e&&O(e)},disabled:a||!e,children:a?"保存中...":"保存配置"})]})]}),s.jsx(m,{children:s.jsx(d,{activeKey:t,onChange:y,items:T})}),s.jsx(x,{title:"JSON配置",open:k,onCancel:()=>w(!1),onOk:()=>{try{const e=JSON.parse(C);O(e),w(!1)}catch(e){v.error("JSON格式错误")}},cancelText:"取消",okText:"确定",width:800,children:s.jsx(g,{value:C,onChange:e=>N(e.target.value),rows:20,placeholder:"请输入JSON格式的配置...",className:"font-mono"})})]})}export{y as default};
