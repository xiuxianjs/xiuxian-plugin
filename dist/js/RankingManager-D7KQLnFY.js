import{o as e,p as a}from"./index-D64fSWen.js";import{l as t}from"./config-C-P0NNBq.js";import{r as s}from"./react-vendor-B_j1QKL9.js";import{g as n,a as r,t as i}from"./rankings-BwgxydrH.js";import{R as l}from"./CrownOutlined-C1NA_heS.js";import{R as o}from"./TeamOutlined--sib1hVJ.js";import{R as c}from"./BankOutlined-DsUBx9Up.js";import{I as d,C as m}from"./AntdIcon-BrIVTVC9.js";import{R as u}from"./FireOutlined-iSvRmuP2.js";import{R as x}from"./TrophyOutlined-BVPMSDgz.js";import{s as j}from"./index-CNd4JuwY.js";import{S as h}from"./index-BVzpzorU.js";import{B as g}from"./EllipsisOutlined-B7G7Lika.js";import{R as p}from"./ReloadOutlined-st9QP56F.js";import{R as f,C as v}from"./row-KUrmra0O.js";import{S as y}from"./index-CNaFVlZv.js";import{R as k,F as S}from"./Table-CcmlabOw.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./InfoCircleFilled-CZmHaujc.js";import"./index-ChgZ5ieq.js";import"./CheckOutlined-BLh5wKOq.js";import"./DownOutlined-CLoAI_il.js";import"./index-GvAVA_fY.js";var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function b(){return b=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},b.apply(this,arguments)}const C=(e,a)=>s.createElement(d,b({},e,{ref:a,icon:R})),L=s.forwardRef(C),O=[{value:"ASSOCIATION_POWER",label:"宗门综合实力",icon:e.jsx(l,{})},{value:"ASSOCIATION_MEMBERS",label:"宗门成员数",icon:e.jsx(o,{})},{value:"ASSOCIATION_LINGSHI",label:"宗门灵石池",icon:e.jsx(c,{})},{value:"ASSOCIATION_LEVEL",label:"宗门等级",icon:e.jsx(L,{})},{value:"PLAYER_LEVEL",label:"玩家境界",icon:e.jsx(u,{})},{value:"PLAYER_ATTACK",label:"玩家攻击力",icon:e.jsx(x,{})},{value:"PLAYER_DEFENSE",label:"玩家防御力",icon:e.jsx(x,{})}];function E(){const{rankingStats:c,selectedRankingType:d,rankingLimit:u,rankingData:R,loading:b,getRankingTypeLabel:C,handleTriggerCalculation:L,fetchRankingStats:E,handleRankingTypeChange:N,handleRankingLimitChange:A,fetchRankingData:w}=(()=>{const{user:e}=a(),[t,l]=s.useState(!1),[o,c]=s.useState(null),[d,m]=s.useState("ASSOCIATION_POWER"),[u,x]=s.useState([]),[h,g]=s.useState(10),p=async()=>{if(e)try{if(!localStorage.getItem("token"))return void j.error("未找到登录令牌");const e=await n();e.success&&e.data?c(e.data):j.error(e.message??"获取排名统计失败")}catch(a){j.error("获取排名统计失败")}},f=async(a,t)=>{if(e){l(!0);try{if(!localStorage.getItem("token"))return void j.error("未找到登录令牌");const e=await r({type:a,limit:t});e.success&&e.data?x(e.data):j.error(e.message??"获取排名数据失败")}catch(s){j.error("获取排名数据失败")}finally{l(!1)}}};return s.useEffect(()=>{p(),f(d,h)},[e]),{rankingStats:o,selectedRankingType:d,rankingData:u,rankingLimit:h,loading:t,handleRankingTypeChange:e=>{m(e),f(e,h)},handleRankingLimitChange:e=>{g(e),f(d,e)},getRankingTypeLabel:e=>{const a=O.find(a=>a.value===e);return a?a.label:e},fetchRankingStats:p,fetchRankingData:f,handleTriggerCalculation:async()=>{if(e)try{if(!localStorage.getItem("token"))return void j.error("未找到登录令牌");j.loading("正在计算排名...",0);const e=await i();j.destroy(),e.success?(j.success("排名计算完成"),p(),f(d,h)):j.error(e.message??"排名计算失败")}catch(a){j.destroy(),j.error("触发排名计算失败")}}}})(),I=[{title:"排名",key:"rank",width:80,render:(e,a)=>a.rank},{title:"名称",key:"name",width:200,render:(a,t)=>{var s,n;return e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:t.name}),(null==(s=t.extra)?void 0:s.名号)&&e.jsxs("div",{className:"text-xs",children:["道号: ",t.extra.名号]}),(null==(n=t.extra)?void 0:n.宗主)&&e.jsxs("div",{className:"text-xs",children:["宗主: ",t.extra.宗主]})]})}},{title:"PLAYER_LEVEL"===d?"境界":"数值",key:"value",width:120,render:(e,a)=>"PLAYER_LEVEL"===d?t[a.value]:a.value.toLocaleString()},{title:"类型",key:"type",width:100,render:(e,a)=>{var t;return"player"===(null==(t=a.extra)?void 0:t.type)?"玩家":"宗门"}}];return e.jsxs("div",{className:"min-h-screen bg-gray-200 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold m-0",children:"排行榜管理"}),e.jsx("p",{className:"text-sm mt-2 mb-0",children:"管理修仙界各种排行榜数据"})]}),e.jsxs(h,{children:[e.jsx(g,{type:"primary",icon:e.jsx(x,{}),onClick:()=>{L()},children:"重新计算排名"}),e.jsx(g,{icon:e.jsx(p,{spin:b}),loading:b,onClick:()=>{E(),w(d,u)},children:"刷新数据"})]})]}),c&&e.jsxs(f,{gutter:[16,16],className:"mb-6",children:[e.jsx(v,{xs:24,md:8,children:e.jsx(m,{className:"shadow-md",children:e.jsx(y,{title:"总排行榜数",value:c.associationCount+c.playerCount,prefix:e.jsx(x,{})})})}),e.jsx(v,{xs:24,md:8,children:e.jsx(m,{className:"shadow-md",children:e.jsx(y,{title:"玩家排行榜",value:c.playerCount,prefix:e.jsx(l,{})})})}),e.jsx(v,{xs:24,md:8,children:e.jsx(m,{className:"shadow-md",children:e.jsx(y,{title:"宗门排行榜",value:c.associationCount,prefix:e.jsx(o,{})})})})]}),e.jsx(m,{title:"排名类型",className:"mb-6",children:e.jsx(k.Group,{value:d,onChange:e=>N(e.target.value),buttonStyle:"solid",children:O.map(a=>e.jsxs(k.Button,{value:a.value,children:[a.icon," ",a.label]},a.value))})}),e.jsx(m,{title:"显示数量",className:"mb-6",children:e.jsx(k.Group,{value:u,onChange:e=>A(e.target.value),buttonStyle:"solid",children:[10,20,50,100].map(a=>e.jsxs(k.Button,{value:a,children:["前",a,"名"]},a))})}),e.jsx(m,{title:`${C(d)} - 前${u}名`,children:e.jsx(S,{columns:I,dataSource:R,rowKey:"id",loading:b,pagination:!1,scroll:{x:800}})})]})}export{E as default};
