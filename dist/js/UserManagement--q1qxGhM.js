import{n as e,I as s,o as a,P as t,R as r}from"./index-D64fSWen.js";import{r as n}from"./react-vendor-B_j1QKL9.js";import{F as i}from"./index-D88ViWFg.js";import{S as c}from"./index-BVzpzorU.js";import{I as l,C as d}from"./AntdIcon-BrIVTVC9.js";import{T as o}from"./index-OFQobG-o.js";import{B as u}from"./EllipsisOutlined-B7G7Lika.js";import{R as m}from"./PlusOutlined-BzVVLDjU.js";import{R as h}from"./CheckCircleOutlined-D9oT3pc1.js";import{R as x,P as j}from"./StopOutlined-C_C0ajgk.js";import{R as p}from"./UserOutlined-BPw5ZWA_.js";import{R as g,C as y}from"./row-KUrmra0O.js";import{S as v}from"./index-CNaFVlZv.js";import{I as f}from"./index-Ba3ggKkW.js";import{S as w,F as S}from"./Table-CcmlabOw.js";import{M as C}from"./index-yWgYGWn4.js";import{s as E}from"./index-CNd4JuwY.js";import{T as k}from"./index-DU3lSUt0.js";import{A as T}from"./index-C97HEmre.js";import{R as z}from"./EditOutlined-BSaIuPsK.js";import{R as b}from"./DeleteOutlined-BGdJH0Vj.js";import"./index-ChgZ5ieq.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./EditOutlined-jOoJX1ad.js";import"./CheckOutlined-BLh5wKOq.js";import"./TextArea-RvXwFgUf.js";import"./index-CdLfu89T.js";import"./DownOutlined-CLoAI_il.js";import"./index-GvAVA_fY.js";import"./InfoCircleFilled-CZmHaujc.js";import"./context-C6B8do_o.js";var O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};function I(){return I=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},I.apply(this,arguments)}const R=(e,s)=>n.createElement(l,I({},e,{ref:s,icon:O})),P=n.forwardRef(R);function A({permission:e,fallback:t=null,children:r}){let n=e=>!1;try{n=s().hasPermission}catch(i){}return n(e)?a.jsx(a.Fragment,{children:r}):a.jsx(a.Fragment,{children:t})}const{Option:U}=w;function F(){const[s,l]=n.useState([]),[O,I]=n.useState(!1),[R,F]=n.useState(""),[D,$]=n.useState(""),[_,N]=n.useState(""),[L,q]=n.useState([]),[B,G]=n.useState(!1),[H,J]=n.useState(null),[K]=i.useForm(),[M,Q]=n.useState({current:1,pageSize:10,total:0}),V=async(s=1,a=10)=>{I(!0);try{const t=await(async(s={})=>{try{const a=await e({url:"/admin/users",method:"GET",params:s});return 200===a.code?{success:!0,message:a.message,data:a.data}:{success:!1,message:a.message||"获取用户列表失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})({page:s,pageSize:a,search:R,role:""===D?void 0:D,status:""===_?void 0:_});t.success&&t.data?(l(t.data.users),Q({current:t.data.page,pageSize:t.data.pageSize,total:t.data.total})):E.error(t.message??"获取用户列表失败")}catch(t){E.error("获取用户列表失败")}finally{I(!1)}},W=async s=>{try{let a;a=H?await(async(s,a)=>{try{const t=await e({url:`/admin/users/${s}`,method:"PUT",data:a});return 200===t.code?{success:!0,message:t.message||"用户更新成功",data:t.data}:{success:!1,message:t.message||"用户更新失败"}}catch(t){return{success:!1,message:"错误，请重试"}}})(H.id,s):await(async s=>{try{const a=await e({url:"/admin/users",method:"POST",data:s});return 200===a.code?{success:!0,message:a.message||"用户创建成功",data:a.data}:{success:!1,message:a.message||"用户创建失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s),a.success?(E.success(H?"用户更新成功":"用户创建成功"),G(!1),K.resetFields(),J(null),V(M.current,M.pageSize)):E.error(a.message??"操作失败")}catch(a){E.error("保存用户失败")}},X=async s=>{try{const a=await(async s=>{try{const a=await e({url:`/admin/users/${s}`,method:"DELETE"});return 200===a.code?{success:!0,message:a.message||"用户删除成功"}:{success:!1,message:a.message||"用户删除失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s);a.success?(E.success("用户删除成功"),V(M.current,M.pageSize)):E.error(a.message??"删除失败")}catch(a){E.error("删除用户失败")}},Y=async s=>{try{const a=await(async s=>{try{const a=await e({url:`/admin/users/${s}/reset-password`,method:"POST"});return 200===a.code?{success:!0,message:a.message||"密码重置成功",data:a.data}:{success:!1,message:a.message||"密码重置失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})(s);a.success&&a.data?E.success(`密码重置成功，新密码：${a.data.newPassword}`):E.error(a.message??"密码重置失败")}catch(a){E.error("重置密码失败")}},Z=async(s,a)=>{try{const t=await(async(s,a)=>{try{const t=await e({url:`/admin/users/${s}/status`,method:"PATCH",data:{status:a}});return 200===t.code?{success:!0,message:t.message||"状态更新成功",data:t.data}:{success:!1,message:t.message||"状态更新失败"}}catch(t){return{success:!1,message:"错误，请重试"}}})(s,a);t.success?(E.success("状态更新成功"),V(M.current,M.pageSize)):E.error(t.message??"状态更新失败")}catch(t){E.error("更新状态失败")}},ee=async s=>{if(0!==L.length)try{const a=await(async s=>{try{const a=await e({url:"/admin/users/batch",method:"POST",data:s});return 200===a.code?{success:!0,message:a.message||"批量操作完成",data:a.data}:{success:!1,message:a.message||"批量操作失败"}}catch(a){return{success:!1,message:"错误，请重试"}}})({userIds:L,operation:s});a.success&&a.data?(E.success(`批量操作完成，成功 ${a.data.successCount} 个，失败 ${a.data.failedCount} 个`),q([]),V(M.current,M.pageSize)):E.error(a.message??"批量操作失败")}catch(a){E.error("批量操作失败")}else E.warning("请选择要操作的用户")},se=[{title:"用户信息",key:"userInfo",width:200,render:(e,s)=>{var t;return a.jsxs(c,{align:"center",children:[a.jsx(T,{children:null==(t=s.username)?void 0:t.charAt(0).toUpperCase()}),a.jsxs(c,{direction:"vertical",size:0,children:[a.jsx(o.Text,{strong:!0,children:s.username}),a.jsx(o.Text,{type:"secondary",children:s.realName??"未设置"})]})]})}},{title:"角色",dataIndex:"role",key:"role",width:120,render:e=>{const s=r[e];return a.jsx(k,{color:s.color,icon:a.jsx("span",{children:s.icon}),children:s.name})}},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>(e=>{const s={active:{color:"green",text:"正常"},inactive:{color:"orange",text:"未激活"},suspended:{color:"red",text:"已暂停"}}[e]??{color:"default",text:e};return a.jsx(k,{color:s.color,children:s.text})})(e)},{title:"部门",dataIndex:"department",key:"department",width:120,render:e=>e??"未设置"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleString("zh-CN")},{title:"最后登录",dataIndex:"lastLoginAt",key:"lastLoginAt",width:150,render:e=>e?new Date(e).toLocaleString("zh-CN"):"从未登录"},{title:"操作",key:"actions",width:200,render:(e,s)=>a.jsxs(c,{children:[a.jsx(A,{permission:t.USER_UPDATE,children:a.jsx(u,{type:"link",size:"small",icon:a.jsx(z,{}),onClick:()=>{return J(e=s),K.setFieldsValue({username:e.username,email:e.email,role:e.role,status:e.status,realName:e.realName,department:e.department,phone:e.phone}),void G(!0);var e},children:"编辑"})}),a.jsx(A,{permission:t.USER_UPDATE,children:a.jsx(u,{type:"link",size:"small",icon:a.jsx(P,{}),onClick:()=>{Y(s.id)},children:"重置密码"})}),a.jsx(A,{permission:t.USER_UPDATE,children:a.jsx(u,{type:"link",size:"small",icon:"active"===s.status?a.jsx(x,{}):a.jsx(h,{}),onClick:()=>{Z(s.id,"active"===s.status?"suspended":"active")},children:"active"===s.status?"暂停":"激活"})}),a.jsx(A,{permission:t.USER_DELETE,children:a.jsx(j,{title:"确定要删除这个用户吗？",onConfirm:()=>{X(s.id)},okText:"确定",cancelText:"取消",children:a.jsx(u,{type:"link",size:"small",icon:a.jsx(b,{}),children:"删除"})})})]})}],ae={selectedRowKeys:L,onChange:e=>{q(e)}},te=()=>{Q(e=>({...e,current:1})),V(1,M.pageSize)};n.useEffect(()=>{V()},[]);const re={total:s.length,active:s.filter(e=>"active"===e.status).length,inactive:s.filter(e=>"inactive"===e.status).length,suspended:s.filter(e=>"suspended"===e.status).length};return a.jsxs(c,{direction:"vertical",size:"large",className:"bg-slate-200 p-4",style:{width:"100%"},children:[a.jsx(d,{title:a.jsxs(c,{align:"center",children:[a.jsx(p,{}),a.jsx(o.Text,{strong:!0,children:"账户管理"})]}),extra:a.jsxs(c,{children:[a.jsx(A,{permission:t.USER_CREATE,children:a.jsx(u,{type:"primary",icon:a.jsx(m,{}),onClick:()=>{J(null),K.resetFields(),G(!0)},children:"创建用户"})}),a.jsx(A,{permission:t.USER_UPDATE,children:a.jsxs(u,{icon:a.jsx(h,{}),disabled:0===L.length,onClick:()=>{ee("activate")},children:["批量激活 (",L.length,")"]})}),a.jsx(A,{permission:t.USER_UPDATE,children:a.jsxs(u,{icon:a.jsx(x,{}),disabled:0===L.length,onClick:()=>{ee("suspend")},children:["批量暂停 (",L.length,")"]})}),a.jsx(u,{type:"primary",loading:O,onClick:()=>{V(M.current,M.pageSize)},children:"刷新"})]}),children:a.jsx(o.Text,{type:"secondary",children:"管理系统用户账户和权限"})}),a.jsxs(g,{gutter:[16,16],children:[a.jsx(y,{xs:24,md:6,children:a.jsx(d,{children:a.jsx(v,{title:"总用户",value:re.total})})}),a.jsx(y,{xs:24,md:6,children:a.jsx(d,{children:a.jsx(v,{title:"正常",value:re.active})})}),a.jsx(y,{xs:24,md:6,children:a.jsx(d,{children:a.jsx(v,{title:"未激活",value:re.inactive})})}),a.jsx(y,{xs:24,md:6,children:a.jsx(d,{children:a.jsx(v,{title:"已暂停",value:re.suspended})})})]}),a.jsx(f.Search,{placeholder:"搜索用户名或真实姓名...",value:R,onChange:e=>F(e.target.value),onSearch:()=>{te()},onPressEnter:()=>{te()},allowClear:!0}),a.jsxs(c,{align:"center",children:[a.jsx(w,{placeholder:"选择角色",value:D,onChange:$,style:{width:200},allowClear:!0,children:Object.values(r).map(e=>a.jsxs(U,{value:e.role,children:[e.icon," ",e.name]},e.role))}),a.jsxs(w,{placeholder:"选择状态",value:_,onChange:N,style:{width:160},allowClear:!0,children:[a.jsx(U,{value:"active",children:"正常"}),a.jsx(U,{value:"inactive",children:"未激活"}),a.jsx(U,{value:"suspended",children:"已暂停"})]}),a.jsx(u,{type:"primary",onClick:()=>{te()},children:"搜索"})]}),a.jsx(d,{title:"用户列表",children:a.jsx(S,{columns:se,dataSource:s,rowKey:"id",loading:O,rowSelection:ae,pagination:{current:M.current,pageSize:M.pageSize,total:M.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onChange:e=>{var s,a;s=e.current,a=e.pageSize,Q(e=>({...e,current:s,pageSize:a})),V(s,a)},scroll:{x:1e3}})}),a.jsx(C,{title:a.jsxs(c,{align:"center",children:[a.jsx(p,{}),a.jsx(o.Text,{children:H?"编辑用户":"创建用户"})]}),open:B,onCancel:()=>{G(!1),J(null),K.resetFields()},onOk:()=>K.submit(),width:600,children:a.jsxs(i,{form:K,layout:"vertical",onFinish:e=>{W(e)},children:[a.jsxs(g,{gutter:16,children:[a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],children:a.jsx(f,{placeholder:"请输入用户名"})})}),a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"email",label:"邮箱",rules:[{type:"email",message:"请输入有效的邮箱地址"}],children:a.jsx(f,{placeholder:"请输入邮箱"})})})]}),a.jsxs(g,{gutter:16,children:[a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"role",label:"角色",rules:[{required:!0,message:"请选择角色"}],children:a.jsx(w,{placeholder:"请选择角色",children:Object.values(r).filter(e=>"super_admin"!==e.role).map(e=>a.jsxs(U,{value:e.role,children:[e.icon," ",e.name]},e.role))})})}),a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:a.jsxs(w,{placeholder:"请选择状态",children:[a.jsx(U,{value:"active",children:"正常"}),a.jsx(U,{value:"inactive",children:"未激活"}),a.jsx(U,{value:"suspended",children:"已暂停"})]})})})]}),a.jsxs(g,{gutter:16,children:[a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"realName",label:"真实姓名",children:a.jsx(f,{placeholder:"请输入真实姓名"})})}),a.jsx(y,{span:12,children:a.jsx(i.Item,{name:"department",label:"部门",children:a.jsx(f,{placeholder:"请输入部门"})})})]}),a.jsx(i.Item,{name:"phone",label:"电话",children:a.jsx(f,{placeholder:"请输入电话"})}),!H&&a.jsx(i.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"}],children:a.jsx(f.Password,{placeholder:"请输入密码"})})]})})]})}export{F as default};
