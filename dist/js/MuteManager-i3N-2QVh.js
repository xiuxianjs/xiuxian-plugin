import{C as e,c as t,a as i,g as n,m as a,u as s,r,l,H as o,S as c,n as d,o as m}from"./index-D64fSWen.js";import{b as g,r as u}from"./react-vendor-B_j1QKL9.js";import{d as h}from"./dayjs.min-55atLurb.js";import{F as p}from"./index-D88ViWFg.js";import{I as x,C as f,T as j}from"./AntdIcon-BrIVTVC9.js";import{T as y}from"./index-OFQobG-o.js";import{S as $}from"./index-BVzpzorU.js";import{b as v,B as S}from"./EllipsisOutlined-B7G7Lika.js";import{R as b}from"./PlusOutlined-BzVVLDjU.js";import{R as C}from"./DeleteOutlined-BGdJH0Vj.js";import{R as w,P as k}from"./StopOutlined-C_C0ajgk.js";import{S as E}from"./index-CNaFVlZv.js";import{R as T}from"./ClockCircleOutlined-DBv5AMFe.js";import{I}from"./index-Ba3ggKkW.js";import{P as O,D as z,E as M,F as H,S as N}from"./Table-CcmlabOw.js";import{M as P}from"./index-yWgYGWn4.js";import{s as B}from"./index-CNd4JuwY.js";import{m as L}from"./DownOutlined-CLoAI_il.js";import{u as D,r as R}from"./index-ChgZ5ieq.js";import{C as G,R as W}from"./row-KUrmra0O.js";import{T as Y}from"./index-DU3lSUt0.js";import{R as F}from"./CheckCircleOutlined-D9oT3pc1.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./EditOutlined-jOoJX1ad.js";import"./CheckOutlined-BLh5wKOq.js";import"./TextArea-RvXwFgUf.js";import"./index-CdLfu89T.js";import"./index-GvAVA_fY.js";import"./InfoCircleFilled-CZmHaujc.js";import"./context-C6B8do_o.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"};const A=g.createContext({});A.Consumer;var X=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i};const q=g.forwardRef((n,a)=>{const{prefixCls:s,children:r,actions:l,extra:o,styles:c,className:d,classNames:m,colStyle:h}=n,p=X(n,["prefixCls","children","actions","extra","styles","className","classNames","colStyle"]),{grid:x,itemLayout:f}=u.useContext(A),{getPrefixCls:j,list:y}=u.useContext(e),$=e=>{var i,n;return t(null===(n=null===(i=null==y?void 0:y.item)||void 0===i?void 0:i.classNames)||void 0===n?void 0:n[e],null==m?void 0:m[e])},v=e=>{var t,i;return Object.assign(Object.assign({},null===(i=null===(t=null==y?void 0:y.item)||void 0===t?void 0:t.styles)||void 0===i?void 0:i[e]),null==c?void 0:c[e])},S=j("list",s),b=l&&l.length>0&&g.createElement("ul",{className:t(`${S}-item-action`,$("actions")),key:"actions",style:v("actions")},l.map((e,t)=>g.createElement("li",{key:`${S}-item-action-${t}`},e,t!==l.length-1&&g.createElement("em",{className:`${S}-item-action-split`})))),C=x?"div":"li",w=g.createElement(C,Object.assign({},p,x?{}:{ref:a},{className:t(`${S}-item`,{[`${S}-item-no-flex`]:!("vertical"===f?o:!(()=>{let e=!1;return u.Children.forEach(r,t=>{"string"==typeof t&&(e=!0)}),e&&u.Children.count(r)>1})())},d)}),"vertical"===f&&o?[g.createElement("div",{className:`${S}-item-main`,key:"content"},r,b),g.createElement("div",{className:t(`${S}-item-extra`,$("extra")),key:"extra",style:v("extra")},o)]:[r,b,i(o,{key:"extra"})]);return x?g.createElement(G,{ref:a,flex:1,style:h},w):w});q.Meta=i=>{var{prefixCls:n,className:a,avatar:s,title:r,description:l}=i,o=X(i,["prefixCls","className","avatar","title","description"]);const{getPrefixCls:c}=u.useContext(e),d=c("list",n),m=t(`${d}-item-meta`,a),h=g.createElement("div",{className:`${d}-item-meta-content`},r&&g.createElement("h4",{className:`${d}-item-meta-title`},r),l&&g.createElement("div",{className:`${d}-item-meta-description`},l));return g.createElement("div",Object.assign({},o,{className:m}),s&&g.createElement("div",{className:`${d}-item-meta-avatar`},s),(r||l)&&h)};const K=e=>{const{listBorderedCls:t,componentCls:i,paddingLG:n,margin:a,itemPaddingSM:r,itemPaddingLG:l,marginLG:o,borderRadiusLG:c}=e,d=s(e.calc(c).sub(e.lineWidth).equal());return{[t]:{border:`${s(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:c,[`${i}-header`]:{borderRadius:`${d} ${d} 0 0`},[`${i}-footer`]:{borderRadius:`0 0 ${d} ${d}`},[`${i}-header,${i}-footer,${i}-item`]:{paddingInline:n},[`${i}-pagination`]:{margin:`${s(a)} ${s(o)}`}},[`${t}${i}-sm`]:{[`${i}-item,${i}-header,${i}-footer`]:{padding:r}},[`${t}${i}-lg`]:{[`${i}-item,${i}-header,${i}-footer`]:{padding:l}}}},J=e=>{const{componentCls:t,screenSM:i,screenMD:n,marginLG:a,marginSM:r,margin:l}=e;return{[`@media screen and (max-width:${n}px)`]:{[t]:{[`${t}-item`]:{[`${t}-item-action`]:{marginInlineStart:a}}},[`${t}-vertical`]:{[`${t}-item`]:{[`${t}-item-extra`]:{marginInlineStart:a}}}},[`@media screen and (max-width: ${i}px)`]:{[t]:{[`${t}-item`]:{flexWrap:"wrap",[`${t}-action`]:{marginInlineStart:r}}},[`${t}-vertical`]:{[`${t}-item`]:{flexWrap:"wrap-reverse",[`${t}-item-main`]:{minWidth:e.contentWidth},[`${t}-item-extra`]:{margin:`auto auto ${s(l)}`}}}}}},Q=e=>{const{componentCls:t,antCls:i,controlHeight:n,minHeight:a,paddingSM:l,marginLG:o,padding:c,itemPadding:d,colorPrimary:m,itemPaddingSM:g,itemPaddingLG:u,paddingXS:h,margin:p,colorText:x,colorTextDescription:f,motionDurationSlow:j,lineWidth:y,headerBg:$,footerBg:v,emptyTextPadding:S,metaMarginBottom:b,avatarMarginRight:C,titleMarginBottom:w,descriptionFontSize:k}=e;return{[t]:Object.assign(Object.assign({},r(e)),{position:"relative","--rc-virtual-list-scrollbar-bg":e.colorSplit,"*":{outline:"none"},[`${t}-header`]:{background:$},[`${t}-footer`]:{background:v},[`${t}-header, ${t}-footer`]:{paddingBlock:l},[`${t}-pagination`]:{marginBlockStart:o,[`${i}-pagination-options`]:{textAlign:"start"}},[`${t}-spin`]:{minHeight:a,textAlign:"center"},[`${t}-items`]:{margin:0,padding:0,listStyle:"none"},[`${t}-item`]:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:d,color:x,[`${t}-item-meta`]:{display:"flex",flex:1,alignItems:"flex-start",maxWidth:"100%",[`${t}-item-meta-avatar`]:{marginInlineEnd:C},[`${t}-item-meta-content`]:{flex:"1 0",width:0,color:x},[`${t}-item-meta-title`]:{margin:`0 0 ${s(e.marginXXS)} 0`,color:x,fontSize:e.fontSize,lineHeight:e.lineHeight,"> a":{color:x,transition:`all ${j}`,"&:hover":{color:m}}},[`${t}-item-meta-description`]:{color:f,fontSize:k,lineHeight:e.lineHeight}},[`${t}-item-action`]:{flex:"0 0 auto",marginInlineStart:e.marginXXL,padding:0,fontSize:0,listStyle:"none","& > li":{position:"relative",display:"inline-block",padding:`0 ${s(h)}`,color:f,fontSize:e.fontSize,lineHeight:e.lineHeight,textAlign:"center","&:first-child":{paddingInlineStart:0}},[`${t}-item-action-split`]:{position:"absolute",insetBlockStart:"50%",insetInlineEnd:0,width:y,height:e.calc(e.fontHeight).sub(e.calc(e.marginXXS).mul(2)).equal(),transform:"translateY(-50%)",backgroundColor:e.colorSplit}}},[`${t}-empty`]:{padding:`${s(c)} 0`,color:f,fontSize:e.fontSizeSM,textAlign:"center"},[`${t}-empty-text`]:{padding:S,color:e.colorTextDisabled,fontSize:e.fontSize,textAlign:"center"},[`${t}-item-no-flex`]:{display:"block"}}),[`${t}-grid ${i}-col > ${t}-item`]:{display:"block",maxWidth:"100%",marginBlockEnd:p,paddingBlock:0,borderBlockEnd:"none"},[`${t}-vertical ${t}-item`]:{alignItems:"initial",[`${t}-item-main`]:{display:"block",flex:1},[`${t}-item-extra`]:{marginInlineStart:o},[`${t}-item-meta`]:{marginBlockEnd:b,[`${t}-item-meta-title`]:{marginBlockStart:0,marginBlockEnd:w,color:x,fontSize:e.fontSizeLG,lineHeight:e.lineHeightLG}},[`${t}-item-action`]:{marginBlockStart:c,marginInlineStart:"auto","> li":{padding:`0 ${s(c)}`,"&:first-child":{paddingInlineStart:0}}}},[`${t}-split ${t}-item`]:{borderBlockEnd:`${s(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"&:last-child":{borderBlockEnd:"none"}},[`${t}-split ${t}-header`]:{borderBlockEnd:`${s(e.lineWidth)} ${e.lineType} ${e.colorSplit}`},[`${t}-split${t}-empty ${t}-footer`]:{borderTop:`${s(e.lineWidth)} ${e.lineType} ${e.colorSplit}`},[`${t}-loading ${t}-spin-nested-loading`]:{minHeight:n},[`${t}-split${t}-something-after-last-item ${i}-spin-container > ${t}-items > ${t}-item:last-child`]:{borderBlockEnd:`${s(e.lineWidth)} ${e.lineType} ${e.colorSplit}`},[`${t}-lg ${t}-item`]:{padding:u},[`${t}-sm ${t}-item`]:{padding:g},[`${t}:not(${t}-vertical)`]:{[`${t}-item-no-flex`]:{[`${t}-item-action`]:{float:"right"}}}}},U=n("List",e=>{const t=a(e,{listBorderedCls:`${e.componentCls}-bordered`,minHeight:e.controlHeightLG});return[Q(t),K(t),J(t)]},e=>({contentWidth:220,itemPadding:`${s(e.paddingContentVertical)} 0`,itemPaddingSM:`${s(e.paddingContentVerticalSM)} ${s(e.paddingContentHorizontal)}`,itemPaddingLG:`${s(e.paddingContentVerticalLG)} ${s(e.paddingContentHorizontalLG)}`,headerBg:"transparent",footerBg:"transparent",emptyTextPadding:e.padding,metaMarginBottom:e.padding,avatarMarginRight:e.padding,titleMarginBottom:e.paddingSM,descriptionFontSize:e.fontSize}));function Z(i,n){const{pagination:a=!1,prefixCls:s,bordered:r=!1,split:d=!0,className:m,rootClassName:g,style:h,children:p,itemLayout:x,loadMore:f,grid:j,dataSource:y=[],size:$,header:S,footer:b,loading:C=!1,rowKey:w,renderItem:k,locale:E}=i,T=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i}(i,["pagination","prefixCls","bordered","split","className","rootClassName","style","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]),I=a&&"object"==typeof a?a:{},[M,H]=u.useState(I.defaultCurrent||1),[N,P]=u.useState(I.defaultPageSize||10),{getPrefixCls:B,direction:G,className:Y,style:F}=l("list"),{renderEmpty:V}=u.useContext(e),X=e=>(t,i)=>{var n;H(t),P(i),a&&(null===(n=null==a?void 0:a[e])||void 0===n||n.call(a,t,i))},q=X("onChange"),K=X("onShowSizeChange"),J=(e,t)=>{if(!k)return null;let i;return i="function"==typeof w?w(e):w?e[w]:e.key,i||(i=`list-item-${t}`),u.createElement(u.Fragment,{key:i},k(e,t))},Q=!!(f||a||b),Z=B("list",s),[_,ee,te]=U(Z);let ie=C;"boolean"==typeof ie&&(ie={spinning:ie});const ne=!!(null==ie?void 0:ie.spinning);let ae="";switch(v($)){case"large":ae="lg";break;case"small":ae="sm"}const se=t(Z,{[`${Z}-vertical`]:"vertical"===x,[`${Z}-${ae}`]:ae,[`${Z}-split`]:d,[`${Z}-bordered`]:r,[`${Z}-loading`]:ne,[`${Z}-grid`]:!!j,[`${Z}-something-after-last-item`]:Q,[`${Z}-rtl`]:"rtl"===G},Y,m,g,ee,te),re=L({current:1,total:0,position:"bottom"},{total:y.length,current:M,pageSize:N},a||{}),le=Math.ceil(re.total/re.pageSize);re.current=Math.min(re.current,le);const oe=a&&u.createElement("div",{className:t(`${Z}-pagination`)},u.createElement(O,Object.assign({align:"end"},re,{onChange:q,onShowSizeChange:K})));let ce=o(y);a&&y.length>(re.current-1)*re.pageSize&&(ce=o(y).splice((re.current-1)*re.pageSize,re.pageSize));const de=Object.keys(j||{}).some(e=>["xs","sm","md","lg","xl","xxl"].includes(e)),me=D(de),ge=u.useMemo(()=>{for(let e=0;e<R.length;e+=1){const t=R[e];if(me[t])return t}},[me]),ue=u.useMemo(()=>{if(!j)return;const e=ge&&j[ge]?j[ge]:j.column;return e?{width:100/e+"%",maxWidth:100/e+"%"}:void 0},[JSON.stringify(j),ge]);let he=ne&&u.createElement("div",{style:{minHeight:53}});if(ce.length>0){const e=ce.map(J);he=j?u.createElement(W,{gutter:j.gutter},u.Children.map(e,e=>u.createElement("div",{key:null==e?void 0:e.key,style:ue},e))):u.createElement("ul",{className:`${Z}-items`},e)}else p||ne||(he=u.createElement("div",{className:`${Z}-empty-text`},(null==E?void 0:E.emptyText)||(null==V?void 0:V("List"))||u.createElement(z,{componentName:"List"})));const pe=re.position,xe=u.useMemo(()=>({grid:j,itemLayout:x}),[JSON.stringify(j),x]);return _(u.createElement(A.Provider,{value:xe},u.createElement("div",Object.assign({ref:n,style:Object.assign(Object.assign({},F),h),className:se},T),("top"===pe||"both"===pe)&&oe,S&&u.createElement("div",{className:`${Z}-header`},S),u.createElement(c,Object.assign({},ie),he,p),b&&u.createElement("div",{className:`${Z}-footer`},b),f||("bottom"===pe||"both"===pe)&&oe)))}const _=u.forwardRef(Z);_.Item=q;function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ee.apply(this,arguments)}const te=(e,t)=>u.createElement(x,ee({},e,{ref:t,icon:V})),ie=u.forwardRef(te);var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"};function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ae.apply(this,arguments)}const se=(e,t)=>u.createElement(x,ae({},e,{ref:t,icon:ne})),re=u.forwardRef(se),{Option:le}=N,oe=({visible:e,onCancel:t})=>{const[i,n]=u.useState("mute"),[a,s]=u.useState([]),[r,l]=u.useState(!1),o=async e=>{l(!0);try{const t=await(async(e="mute",t=100)=>{try{const i=await d({url:`/mute-logs?type=${e}&limit=${t}`,method:"GET"});return 200===i.code?{success:!0,data:i.data}:{success:!1,message:i.message}}catch(i){return{success:!1,message:"网络错误"}}})(e,100);t.success&&t.data?s(t.data.list):B.error(t.message??"获取日志失败")}catch(t){B.error("获取日志失败")}finally{l(!1)}},c=async e=>{try{const t=await(async(e="all")=>{try{const t=await d({url:`/mute-logs?type=${e}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(e);t.success?(B.success(t.message??"清理日志成功"),o(i)):B.error(t.message??"清理日志失败")}catch(t){B.error("清理日志失败")}};u.useEffect(()=>{e&&o(i)},[e,i]);const g=[{key:"mute",label:m.jsxs($,{align:"center",children:[m.jsx(w,{}),m.jsx("span",{children:"禁言记录"})]}),children:m.jsxs($,{direction:"vertical",style:{width:"100%"},size:"middle",children:[m.jsxs($,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[m.jsx(y.Title,{level:5,style:{margin:0},children:"禁言记录"}),m.jsx(k,{title:"确定要清理禁言记录吗？",onConfirm:()=>{c("mute")},okText:"确定",cancelText:"取消",children:m.jsx(S,{danger:!0,size:"small",children:"清理禁言记录"})})]}),m.jsx(_,{loading:r,locale:{emptyText:m.jsx(M,{description:"暂无禁言记录"})},dataSource:a,renderItem:e=>m.jsx(_.Item,{children:m.jsxs($,{direction:"vertical",size:2,style:{width:"100%"},children:[m.jsxs($,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[m.jsxs($,{size:"middle",children:[m.jsx(y.Text,{code:!0,children:e.userId}),e.reason?m.jsx(Y,{color:"orange",children:e.reason}):null,e.duration?m.jsxs(Y,{color:"blue",children:[Math.floor((e.duration??0)/60),"分钟"]}):null]}),m.jsx(y.Text,{type:"secondary",children:h(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId?m.jsxs(y.Text,{type:"secondary",children:["操作管理员: ",e.adminId]}):null]})})})]})},{key:"unmute",label:m.jsxs($,{align:"center",children:[m.jsx(F,{}),m.jsx("span",{children:"解除记录"})]}),children:m.jsxs($,{direction:"vertical",style:{width:"100%"},size:"middle",children:[m.jsxs($,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[m.jsx(y.Title,{level:5,style:{margin:0},children:"解除记录"}),m.jsx(k,{title:"确定要清理解除记录吗？",onConfirm:()=>{c("unmute")},okText:"确定",cancelText:"取消",children:m.jsx(S,{danger:!0,size:"small",children:"清理解除记录"})})]}),m.jsx(_,{loading:r,locale:{emptyText:m.jsx(M,{description:"暂无解除记录"})},dataSource:a,renderItem:e=>m.jsx(_.Item,{children:m.jsxs($,{direction:"vertical",size:2,style:{width:"100%"},children:[m.jsxs($,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[m.jsxs($,{size:"middle",children:[m.jsx(y.Text,{code:!0,children:e.userId}),e.reason?m.jsx(Y,{color:"green",children:e.reason}):null]}),m.jsx(y.Text,{type:"secondary",children:h(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId?m.jsxs(y.Text,{type:"secondary",children:["操作管理员: ",e.adminId]}):null]})})})]})}];return m.jsx(P,{title:m.jsxs($,{align:"center",children:[m.jsx(ie,{}),m.jsx(y.Text,{children:"禁言日志"})]}),open:e,onCancel:t,footer:m.jsxs($,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[m.jsx(k,{title:"确定要清理所有日志吗？",onConfirm:()=>{c("all")},okText:"确定",cancelText:"取消",children:m.jsx(S,{danger:!0,children:"清理所有日志"})}),m.jsx(S,{onClick:t,children:"关闭"})]}),width:900,children:m.jsx(j,{activeKey:i,onChange:e=>{n(e),o(e)},items:g})})},ce=()=>{const[e,t]=u.useState([]),[i,n]=u.useState(!1),[a,s]=u.useState(""),[r,l]=u.useState(1),[o,c]=u.useState(10),[g,x]=u.useState(0),[j,v]=u.useState([]),[O,z]=u.useState(!1),[L,D]=u.useState(!1),[R]=p.useForm(),G=async()=>{n(!0);try{const e=await(async()=>{try{const e=await d({url:"/mute-list",method:"GET"});return 200===e.code?{success:!0,data:e.data}:{success:!1,message:e.message}}catch(e){return{success:!1,message:"网络错误"}}})();e.success&&e.data?(t(e.data.list),x(e.data.total)):B.error(e.message??"获取禁言列表失败")}catch(e){B.error("获取禁言列表失败")}finally{n(!1)}},W=async e=>{try{const t=await(async e=>{try{const t=await d({url:"/mute-list",method:"POST",data:e});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(e);t.success?(B.success("禁言设置成功"),z(!1),R.resetFields(),G()):B.error(t.message??"禁言设置失败")}catch(t){B.error("禁言设置失败")}},Y=async e=>{try{const t=await(async e=>{try{const t=await d({url:`/mute-list?userId=${e}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(e);t.success?(B.success("禁言解除成功"),G()):B.error(t.message??"禁言解除失败")}catch(t){B.error("禁言解除失败")}},F=async()=>{if(0!==j.length)try{const e=await(async e=>{try{const t=await d({url:"/mute-list",method:"PUT",data:{userIds:e}});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(j);e.success&&e.data?(B.success(`批量解除禁言完成，成功解除 ${e.data.successCount} 个用户`),v([]),G()):B.error(e.message??"批量解除禁言失败")}catch(e){B.error("批量解除禁言失败")}else B.warning("请选择要解除禁言的用户")},V=e.filter(e=>e.userId.toLowerCase().includes(a.toLowerCase())),A=[{title:"用户ID",dataIndex:"userId",key:"userId",render:e=>m.jsx(y.Text,{code:!0,children:e})},{title:"剩余时间",dataIndex:"remainingTime",key:"remainingTime",render:e=>m.jsx(y.Text,{children:e})},{title:"解除时间",dataIndex:"unlockTime",key:"unlockTime",render:e=>m.jsx(y.Text,{children:h(e).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",render:(e,t)=>m.jsx($,{children:m.jsx(k,{title:"确定要解除该用户的禁言吗？",onConfirm:()=>{Y(t.userId)},okText:"确定",cancelText:"取消",children:m.jsx(S,{type:"link",size:"small",icon:m.jsx(re,{}),children:"解除禁言"})})})}],X={selectedRowKeys:j,onChange:e=>{v(e)}};return u.useEffect(()=>{G()},[]),m.jsxs("div",{className:"space-y-6 p-4 bg-slate-200",children:[m.jsx(f,{title:m.jsxs($,{align:"center",children:[m.jsx(w,{}),m.jsx(y.Text,{strong:!0,children:"禁言管理"})]}),extra:m.jsxs($,{children:[m.jsx(S,{type:"primary",icon:m.jsx(b,{}),onClick:()=>z(!0),children:"添加禁言"}),m.jsxs(S,{danger:!0,icon:m.jsx(C,{}),disabled:0===j.length,onClick:()=>{F()},children:["批量解除 (",j.length,")"]}),m.jsx(S,{icon:m.jsx(ie,{}),onClick:()=>D(!0),children:"查看日志"}),m.jsx(S,{type:"primary",loading:i,onClick:()=>{G()},children:"刷新"})]}),children:m.jsx(y.Text,{type:"secondary",children:"管理系统中的用户禁言状态"})}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[m.jsx(f,{children:m.jsx(E,{title:"当前禁言用户",value:g,prefix:m.jsx(w,{})})}),m.jsx(f,{children:m.jsx(E,{title:"即将解除",value:e.filter(e=>e.ttl<=3600).length,prefix:m.jsx(T,{})})}),m.jsx(f,{children:m.jsx(E,{title:"已选择",value:j.length,prefix:m.jsx(re,{})})})]}),m.jsx(I.Search,{placeholder:"搜索用户ID...",value:a,onChange:e=>s(e.target.value),onSearch:()=>{},allowClear:!0}),m.jsx(f,{title:"禁言列表",children:0===V.length?m.jsx(M,{description:"当前没有用户被禁言"}):m.jsx(H,{columns:A,dataSource:V,rowKey:"userId",loading:i,rowSelection:X,pagination:{current:r,pageSize:o,total:V.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`},onChange:e=>{l(e.current??1),c(e.pageSize??10)},scroll:{x:800}})}),m.jsx(P,{title:m.jsxs($,{align:"center",children:[m.jsx(w,{}),m.jsx(y.Text,{children:"添加禁言"})]}),open:O,onCancel:()=>z(!1),onOk:()=>R.submit(),okText:"确定",cancelText:"取消",width:500,children:m.jsxs(p,{form:R,layout:"vertical",onFinish:e=>{W(e)},children:[m.jsx(p.Item,{name:"userId",label:"用户ID",rules:[{required:!0,message:"请输入用户ID"}],children:m.jsx(I,{placeholder:"请输入用户ID"})}),m.jsx(p.Item,{name:"duration",label:"禁言时长",rules:[{required:!0,message:"请输入禁言时长"}],children:m.jsx(I,{placeholder:"例如: 30m, 2h, 3600s",addonAfter:m.jsxs(N,{defaultValue:"m",style:{width:80},children:[m.jsx(le,{value:"m",children:"分钟"}),m.jsx(le,{value:"h",children:"小时"}),m.jsx(le,{value:"s",children:"秒"})]})})}),m.jsx(p.Item,{name:"reason",label:"禁言原因",children:m.jsx(I.TextArea,{placeholder:"请输入禁言原因（可选）",rows:3})})]})}),m.jsx(oe,{visible:L,onCancel:()=>D(!1)})]})};export{ce as default};
