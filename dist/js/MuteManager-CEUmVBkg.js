import{d as e,j as s}from"./index-D_MJe6zM.js";import{r as t}from"./react-vendor-BNT5GVrG.js";import{d as a}from"./dayjs.min-n4JvDb2F.js";import{B as r,I as c,S as n}from"./XiuxianUserSelector-DASyPVze.js";import{X as i}from"./XiuxianStatCard-D4WhY05d.js";import{X as l}from"./XiuxianPageWrapper-B1AdHBaw.js";import{X as o}from"./XiuxianPageTitle-BbilSi7y.js";import{X as d}from"./XiuxianSearchBar-BpJdRqGF.js";import{X as m}from"./XiuxianTableContainer-D2SISON0.js";import{X as x}from"./XiuxianRefreshButton-ljk9qgRd.js";import{X as u}from"./XiuxianEmptyState-Dv_2gFKy.js";import{X as h}from"./XiuxianTabGroup-6HGRfIfB.js";import{X as j}from"./XiuxianTableWithPagination-PoPKbZrS.js";import{F as p}from"./index-D4Isll76.js";import{R as g}from"./PlusOutlined-eOaNcRN_.js";import{R as f}from"./DeleteOutlined-DYsjSCQg.js";import{I as v,S as N}from"./AntdIcon-Dh7U4Zef.js";import{R as y,P as b}from"./StopOutlined-B1CJnHK1.js";import{a as w}from"./ExclamationCircleOutlined-CmmA0CUO.js";import{M as I}from"./index-BU49QM3r.js";import{s as T}from"./index-BVTzMf5I.js";import{R as C}from"./UserOutlined-8lhfm1Fu.js";import{T as S}from"./index-CkyAoPIO.js";import{R as k}from"./CheckCircleOutlined-AVkdf0XI.js";import"./SearchOutlined-CAppUgpa.js";import"./row-2n5G5YQ5.js";import"./index-Dw3SA_Op.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-C3_TLkz8.js";import"./context-B-5eSelg.js";var O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"};function X(){return X=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},X.apply(this,arguments)}const E=(e,s)=>t.createElement(v,X({},e,{ref:s,icon:O})),H=t.forwardRef(E);var z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"};function D(){return D=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},D.apply(this,arguments)}const M=(e,s)=>t.createElement(v,D({},e,{ref:s,icon:z})),Y=t.forwardRef(M),{Option:P}=n,R=({visible:c,onCancel:n})=>{const[i,l]=t.useState("mute"),[o,d]=t.useState([]),[m,x]=t.useState(!1),u=async s=>{x(!0);try{const t=await(async(s="mute",t=100)=>{try{const a=await e({url:`/mute-logs?type=${s}&limit=${t}`,method:"GET"});return 200===a.code?{success:!0,data:a.data}:{success:!1,message:a.message}}catch(a){return{success:!1,message:"网络错误"}}})(s,100);t.success&&t.data?d(t.data.list):T.error(t.message||"获取日志失败")}catch(t){T.error("获取日志失败")}finally{x(!1)}},j=async s=>{try{const t=await(async(s="all")=>{try{const t=await e({url:`/mute-logs?type=${s}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(T.success(t.message||"清理日志成功"),u(i)):T.error(t.message||"清理日志失败")}catch(t){T.error("清理日志失败")}};t.useEffect(()=>{c&&u(i)},[c,i]);const p=[{name:"mute",icon:s.jsx(y,{}),content:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"禁言记录"}),s.jsx(b,{title:"确定要清理禁言记录吗？",onConfirm:()=>j("mute"),okText:"确定",cancelText:"取消",children:s.jsx(r,{danger:!0,size:"small",children:"清理禁言记录"})})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:m?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"加载中..."})}):0===o.length?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"暂无禁言记录"})}):s.jsx("div",{className:"space-y-2",children:o.map((e,t)=>s.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"font-mono text-sm text-white",children:e.userId}),e.reason&&s.jsx(S,{color:"orange",className:"text-xs",children:e.reason}),e.duration&&s.jsxs(S,{color:"blue",className:"text-xs",children:[Math.floor(e.duration/60),"分钟"]})]}),s.jsx("div",{className:"text-slate-400 text-xs",children:a(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId&&s.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["操作管理员: ",e.adminId]})]},t))})})]})},{name:"unmute",icon:s.jsx(k,{}),content:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"解除记录"}),s.jsx(b,{title:"确定要清理解除记录吗？",onConfirm:()=>j("unmute"),okText:"确定",cancelText:"取消",children:s.jsx(r,{danger:!0,size:"small",children:"清理解除记录"})})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:m?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"加载中..."})}):0===o.length?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"暂无解除记录"})}):s.jsx("div",{className:"space-y-2",children:o.map((e,t)=>s.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"font-mono text-sm text-white",children:e.userId}),e.reason&&s.jsx(S,{color:"green",className:"text-xs",children:e.reason})]}),s.jsx("div",{className:"text-slate-400 text-xs",children:a(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId&&s.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["操作管理员: ",e.adminId]})]},t))})})]})}];return s.jsx(I,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(H,{className:"text-blue-400"}),s.jsx("span",{className:"text-white",children:"禁言日志"})]}),open:c,onCancel:n,footer:s.jsxs("div",{className:"flex justify-between",children:[s.jsx(b,{title:"确定要清理所有日志吗？",onConfirm:()=>j("all"),okText:"确定",cancelText:"取消",children:s.jsx(r,{danger:!0,children:"清理所有日志"})}),s.jsx(r,{onClick:n,children:"关闭"})]}),className:"xiuxian-modal",width:900,children:s.jsx(h,{tabs:p,activeTab:i,onTabChange:e=>{l(e),u(e)},className:"mt-4"})})},$=()=>{const[h,v]=t.useState([]),[S,k]=t.useState(!1),[O,X]=t.useState(""),[E,z]=t.useState(1),[D,M]=t.useState(10),[$,L]=t.useState(0),[V,B]=t.useState([]),[A,F]=t.useState(!1),[G,U]=t.useState(!1),[q]=p.useForm(),K=async()=>{k(!0);try{const s=await(async()=>{try{const s=await e({url:"/mute-list",method:"GET"});return 200===s.code?{success:!0,data:s.data}:{success:!1,message:s.message}}catch(s){return{success:!1,message:"网络错误"}}})();s.success&&s.data?(v(s.data.list),L(s.data.total)):T.error(s.message||"获取禁言列表失败")}catch(s){T.error("获取禁言列表失败")}finally{k(!1)}},Q=async s=>{try{const t=await(async s=>{try{const t=await e({url:`/mute-list?userId=${s}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(T.success("禁言解除成功"),K()):T.error(t.message||"禁言解除失败")}catch(t){T.error("禁言解除失败")}},W=h.filter(e=>e.userId.toLowerCase().includes(O.toLowerCase())),J=W.slice((E-1)*D,E*D),Z=[{title:s.jsxs("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:[s.jsx(C,{className:"text-lg"}),s.jsx("span",{children:"用户ID"})]}),dataIndex:"userId",key:"userId",render:e=>s.jsx("span",{className:"font-mono text-sm text-white bg-slate-700/50 px-2 py-1 rounded",children:e})},{title:s.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold",children:[s.jsx(w,{className:"text-lg"}),s.jsx("span",{children:"剩余时间"})]}),dataIndex:"remainingTime",key:"remainingTime",render:(e,t)=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-orange-400 font-medium",children:e})})},{title:s.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:s.jsx("span",{children:"解除时间"})}),dataIndex:"unlockTime",key:"unlockTime",render:e=>s.jsx("span",{className:"text-slate-300",children:a(e).format("YYYY-MM-DD HH:mm:ss")})},{title:s.jsx("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:s.jsx("span",{children:"操作"})}),key:"action",render:(e,t)=>s.jsx(N,{children:s.jsx(b,{title:"确定要解除该用户的禁言吗？",onConfirm:()=>Q(t.userId),okText:"确定",cancelText:"取消",children:s.jsx(r,{type:"text",size:"small",icon:s.jsx(Y,{}),className:"text-green-400 hover:text-green-300 hover:bg-green-400/10",children:"解除禁言"})})})}],_={selectedRowKeys:V,onChange:e=>{B(e)}};return t.useEffect(()=>{K()},[]),s.jsxs(l,{children:[s.jsx(o,{icon:"🔇",title:"禁言管理",subtitle:"管理系统中的用户禁言状态",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(r,{type:"primary",icon:s.jsx(g,{}),onClick:()=>F(!0),className:"bg-gradient-to-r from-red-500 to-pink-500 border-0 hover:from-red-600 hover:to-pink-600",children:"添加禁言"}),s.jsxs(r,{danger:!0,icon:s.jsx(f,{}),disabled:0===V.length,onClick:async()=>{if(0!==V.length)try{const s=await(async s=>{try{const t=await e({url:"/mute-list",method:"PUT",data:{userIds:s}});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(V);s.success&&s.data?(T.success(`批量解除禁言完成，成功解除 ${s.data.successCount} 个用户`),B([]),K()):T.error(s.message||"批量解除禁言失败")}catch(s){T.error("批量解除禁言失败")}else T.warning("请选择要解除禁言的用户")},children:["批量解除 (",V.length,")"]}),s.jsx(r,{icon:s.jsx(H,{}),onClick:()=>U(!0),className:"bg-gradient-to-r from-blue-500 to-cyan-500 border-0 hover:from-blue-600 hover:to-cyan-600",children:"查看日志"}),s.jsx(x,{loading:S,onClick:K})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx(i,{title:"当前禁言用户",value:$,icon:s.jsx(y,{}),gradient:"red"}),s.jsx(i,{title:"即将解除",value:h.filter(e=>e.ttl<=3600).length,icon:s.jsx(w,{}),gradient:"orange"}),s.jsx(i,{title:"已选择",value:V.length,icon:s.jsx(Y,{}),gradient:"green"})]}),s.jsx(d,{placeholder:"搜索用户ID...",value:O,onChange:X,onSearch:()=>{}}),s.jsx(m,{title:"禁言列表",children:0===W.length?s.jsx(u,{icon:"🔇",title:"暂无禁言记录",description:"当前没有用户被禁言"}):s.jsx(j,{columns:Z,dataSource:J,rowKey:"userId",loading:S,rowSelection:_,pagination:{current:E,pageSize:D,total:W.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onPaginationChange:(e,s)=>{z(e),M(s||10)}})})]}),s.jsx(I,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"text-red-400"}),s.jsx("span",{className:"text-white",children:"添加禁言"})]}),open:A,onCancel:()=>F(!1),onOk:()=>q.submit(),okText:"确定",cancelText:"取消",className:"xiuxian-modal",width:500,children:s.jsxs(p,{form:q,layout:"vertical",onFinish:async s=>{try{const t=await(async s=>{try{const t=await e({url:"/mute-list",method:"POST",data:s});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(T.success("禁言设置成功"),F(!1),q.resetFields(),K()):T.error(t.message||"禁言设置失败")}catch(t){T.error("禁言设置失败")}},className:"mt-4",children:[s.jsx(p.Item,{name:"userId",label:s.jsx("span",{className:"text-slate-300",children:"用户ID"}),rules:[{required:!0,message:"请输入用户ID"}],children:s.jsx(c,{placeholder:"请输入用户ID",className:"xiuxian-input"})}),s.jsx(p.Item,{name:"duration",label:s.jsx("span",{className:"text-slate-300",children:"禁言时长"}),rules:[{required:!0,message:"请输入禁言时长"}],children:s.jsx(c,{placeholder:"例如: 30m, 2h, 3600s",className:"xiuxian-input",addonAfter:s.jsxs(n,{defaultValue:"m",className:"w-20",children:[s.jsx(P,{value:"m",children:"分钟"}),s.jsx(P,{value:"h",children:"小时"}),s.jsx(P,{value:"s",children:"秒"})]})})}),s.jsx(p.Item,{name:"reason",label:s.jsx("span",{className:"text-slate-300",children:"禁言原因"}),children:s.jsx(c.TextArea,{placeholder:"请输入禁言原因（可选）",rows:3,className:"xiuxian-input"})})]})}),s.jsx(R,{visible:G,onCancel:()=>U(!1)})]})};export{$ as default};
