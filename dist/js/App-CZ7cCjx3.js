import{n as e,o as t}from"./index-D64fSWen.js";import{r}from"./react-vendor-B_j1QKL9.js";import{d as s}from"./dayjs.min-55atLurb.js";import{F as a}from"./index-D88ViWFg.js";import{S as i}from"./index-BVzpzorU.js";import{B as l}from"./EllipsisOutlined-B7G7Lika.js";import{R as n}from"./PlusOutlined-BzVVLDjU.js";import{R as o,P as c}from"./StopOutlined-C_C0ajgk.js";import{R as d}from"./ReloadOutlined-st9QP56F.js";import{R as m,C as x}from"./row-KUrmra0O.js";import{I as h,C as j}from"./AntdIcon-BrIVTVC9.js";import{S as p}from"./index-CNaFVlZv.js";import{R as u}from"./ExclamationCircleOutlined-Civca5ce.js";import{R as f}from"./CheckCircleOutlined-D9oT3pc1.js";import{R as g}from"./DeleteOutlined-BGdJH0Vj.js";import{I as y}from"./index-Ba3ggKkW.js";import{R as v}from"./EyeOutlined-DyWz_EC7.js";import{E as w,F as b,S as I}from"./Table-CcmlabOw.js";import{M as C}from"./index-yWgYGWn4.js";import{s as O}from"./index-CNd4JuwY.js";import{T as S}from"./index-ChgZ5ieq.js";import{T}from"./index-DU3lSUt0.js";import"./ExclamationCircleFilled-DT70Ahrp.js";import"./index-CdLfu89T.js";import"./TextArea-RvXwFgUf.js";import"./CheckOutlined-BLh5wKOq.js";import"./DownOutlined-CLoAI_il.js";import"./index-GvAVA_fY.js";import"./InfoCircleFilled-CZmHaujc.js";import"./context-C6B8do_o.js";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},z.apply(this,arguments)}const E=(e,t)=>r.createElement(h,z({},e,{ref:t,icon:k})),N=r.forwardRef(E);var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},D.apply(this,arguments)}const F=(e,t)=>r.createElement(h,D({},e,{ref:t,icon:R})),P=r.forwardRef(F),{TextArea:A}=y,{Option:M}=I,q=()=>{const[h,k]=r.useState(null),[z,E]=r.useState(null),[R,D]=r.useState(!1),[F,q]=r.useState(!1),[$]=a.useForm(),[B,H]=r.useState(""),[L,Y]=r.useState({current:1,pageSize:10,total:0}),G=async()=>{try{const r=await(t={global:!0},e({url:"/message-stats",method:"GET",params:t}));E(r.data)}catch(r){O.error("获取统计信息失败")}var t},V=async(t,r=1,s=10)=>{if(t){D(!0);try{const i=await(a={userId:t,page:r,pageSize:s},e({url:"/messages",method:"GET",params:a}));k(i.data),Y({current:i.data.page,pageSize:i.data.pageSize,total:i.data.total})}catch(i){O.error("获取消息列表失败")}finally{D(!1)}var a}},J=async t=>{try{const r={title:t.title,content:t.content,type:t.type,priority:t.priority??2,receivers:t.receivers?t.receivers.split(",").map(e=>e.trim()):[],expireTime:t.expireTime?new Date(t.expireTime).getTime():void 0};await(t=>e({url:"/messages",method:"POST",data:t}))(r),O.success("消息发送成功"),q(!1),$.resetFields(),G()}catch(r){O.error("发送消息失败")}},K=async(t,r)=>{try{await(s={userId:t,messageId:r},e({url:"/messages",method:"DELETE",data:s})),O.success("删除成功"),V(t,L.current,L.pageSize)}catch(a){O.error("删除失败")}var s},Q=async()=>{try{const t=await e({url:"/message-stats",method:"POST"});O.success(`清理成功，共清理 ${t.data.cleanedCount} 条过期消息`),G()}catch(t){O.error("清理失败")}},U=[{title:"消息标题",dataIndex:"title",key:"title",width:200,ellipsis:!0},{title:"消息内容",dataIndex:"content",key:"content",width:300,ellipsis:!0,render:e=>t.jsx(S,{title:e,children:e.length>50?`${e.substring(0,50)}...`:e})},{title:"消息类型",dataIndex:"type",key:"type",width:120,render:e=>{const r={system:{color:"blue",text:"系统消息"},announcement:{color:"red",text:"公告"},reward:{color:"green",text:"奖励通知"},activity:{color:"orange",text:"活动通知"},personal:{color:"purple",text:"个人消息"}}[e]??{color:"default",text:e};return t.jsx(T,{color:r.color,children:r.text})}},{title:"优先级",dataIndex:"priority",key:"priority",width:100,render:e=>{const r={1:{color:"default",text:"低"},2:{color:"blue",text:"普通"},3:{color:"orange",text:"高"},4:{color:"red",text:"紧急"}}[e]??{color:"default",text:"普通"};return t.jsx(T,{color:r.color,children:r.text})}},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>{const r={0:{color:"red",text:"未读"},1:{color:"green",text:"已读"},2:{color:"default",text:"已删除"}}[e]??{color:"default",text:"未知"};return t.jsx(T,{color:r.color,children:r.text})}},{title:"发送者",dataIndex:"senderName",key:"senderName",width:120,render:e=>e??"系统"},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180,render:e=>s(e).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"action",width:120,render:(e,r)=>t.jsx(c,{title:"确定要删除这条消息吗？",onConfirm:()=>{K(B,r.id)},okText:"确定",cancelText:"取消",children:t.jsx(l,{type:"link",size:"small",danger:!0,icon:t.jsx(g,{}),children:"删除"})})}];return r.useEffect(()=>{G()},[]),t.jsxs("div",{className:"min-h-screen bg-gray-200 p-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold m-0",children:"站内信管理"}),t.jsx("p",{className:"text-sm mt-2 mb-0",children:"管理修仙界道友的站内信系统"})]}),t.jsxs(i,{children:[t.jsx(l,{type:"primary",icon:t.jsx(n,{}),onClick:()=>q(!0),children:"发送消息"}),t.jsx(l,{danger:!0,icon:t.jsx(o,{}),onClick:()=>{Q()},children:"清理过期"}),t.jsx(l,{icon:t.jsx(d,{spin:R}),onClick:()=>{G(),B&&V(B,L.current,L.pageSize)},loading:R,children:"刷新数据"})]})]}),t.jsxs(m,{gutter:[16,16],className:"mb-6",children:[t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(j,{className:"shadow-md",children:t.jsx(p,{title:"总消息数",value:(null==z?void 0:z.total)??0,prefix:t.jsx(N,{})})})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(j,{className:"shadow-md",children:t.jsx(p,{title:"未读消息",value:(null==z?void 0:z.unread)??0,prefix:t.jsx(u,{})})})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(j,{className:"shadow-md",children:t.jsx(p,{title:"已读消息",value:(null==z?void 0:z.read)??0,prefix:t.jsx(f,{})})})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(j,{className:"shadow-md",children:t.jsx(p,{title:"已删除消息",value:(null==z?void 0:z.deleted)??0,prefix:t.jsx(g,{})})})})]}),t.jsx(j,{title:"查看用户消息",className:"mb-6 shadow-md",children:t.jsxs(i.Compact,{className:"w-full",children:[t.jsx(y,{placeholder:"输入用户ID查看消息...",value:B,onChange:e=>H(e.target.value),onPressEnter:()=>{V(B)}}),t.jsx(l,{type:"primary",icon:t.jsx(v,{}),onClick:()=>{V(B)},disabled:!B,children:"查看消息"})]})}),t.jsx(j,{title:"消息列表",className:"shadow-md",children:B?0===(null==h?void 0:h.messages.length)?t.jsx(w,{description:"该用户目前没有任何消息记录"}):t.jsx(b,{columns:U,dataSource:(null==h?void 0:h.messages)??[],rowKey:"id",loading:R,pagination:{current:L.current,pageSize:L.pageSize,total:L.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{V(B,e,t??10)}}}):t.jsx(w,{description:"请先输入用户ID来查看该用户的消息列表"})}),t.jsx(C,{title:"发送站内信",open:F,onCancel:()=>q(!1),footer:null,width:600,children:t.jsxs(a,{form:$,layout:"vertical",onFinish:e=>{J(e)},initialValues:{type:"system",priority:2},children:[t.jsx(a.Item,{name:"title",label:"消息标题",rules:[{required:!0,message:"请输入消息标题"}],children:t.jsx(y,{placeholder:"请输入消息标题"})}),t.jsx(a.Item,{name:"content",label:"消息内容",rules:[{required:!0,message:"请输入消息内容"}],children:t.jsx(A,{rows:4,placeholder:"请输入消息内容"})}),t.jsxs(m,{gutter:16,children:[t.jsx(x,{span:12,children:t.jsx(a.Item,{name:"type",label:"消息类型",rules:[{required:!0,message:"请选择消息类型"}],children:t.jsxs(I,{placeholder:"请选择消息类型",children:[t.jsx(M,{value:"system",children:"系统消息"}),t.jsx(M,{value:"announcement",children:"公告"}),t.jsx(M,{value:"reward",children:"奖励通知"}),t.jsx(M,{value:"activity",children:"活动通知"}),t.jsx(M,{value:"personal",children:"个人消息"})]})})}),t.jsx(x,{span:12,children:t.jsx(a.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:t.jsxs(I,{placeholder:"请选择优先级",children:[t.jsx(M,{value:1,children:"低"}),t.jsx(M,{value:2,children:"普通"}),t.jsx(M,{value:3,children:"高"}),t.jsx(M,{value:4,children:"紧急"})]})})})]}),t.jsx(a.Item,{name:"receivers",label:"接收者ID",extra:"多个用户ID用逗号分隔，留空表示全服发送",children:t.jsx(y,{placeholder:"例如: 123456,789012"})}),t.jsx(a.Item,{name:"expireTime",label:"过期时间",extra:"可选，留空表示永不过期",children:t.jsx(y,{type:"datetime-local"})}),t.jsx(a.Item,{children:t.jsxs(i,{children:[t.jsx(l,{type:"primary",htmlType:"submit",icon:t.jsx(P,{}),children:"发送"}),t.jsx(l,{onClick:()=>q(!1),children:"取消"})]})})]})})]})};export{q as default};
